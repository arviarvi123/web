<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ChitChat - Connect & Chat</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap');
        
        * {
            font-family: 'Poppins', sans-serif;
        }
        
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        
        .pastel-pink {
            background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%);
        }
        
        .pastel-blue {
            background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);
        }
        
        .pastel-purple {
            background: linear-gradient(135deg, #d299c2 0%, #fef9d7 100%);
        }
        
        .glass-effect {
            background: rgba(255, 255, 255, 0.25);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.18);
        }
        
        .chat-bubble {
            animation: slideIn 0.3s ease-out;
        }
        
        @keyframes slideIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .floating {
            animation: float 3s ease-in-out infinite;
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }
        
        .pulse-ring {
            animation: pulse-ring 1.5s cubic-bezier(0.215, 0.61, 0.355, 1) infinite;
        }
        
        @keyframes pulse-ring {
            0% { transform: scale(0.33); }
            80%, 100% { opacity: 0; }
        }
        
        .hidden { display: none; }
        
        .easter-egg {
            position: fixed;
            font-size: 2rem;
            pointer-events: none;
            z-index: 1000;
            animation: sparkle 2s ease-out forwards;
        }
        
        @keyframes sparkle {
            0% { opacity: 1; transform: scale(0) rotate(0deg); }
            50% { opacity: 1; transform: scale(1) rotate(180deg); }
            100% { opacity: 0; transform: scale(0) rotate(360deg); }
        }
        
        /* Theme Classes */
        :root {
            --theme-bg: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);
        }
        
        .pastel-blue {
            background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%) !important;
        }
        
        .pastel-pink {
            background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%) !important;
        }
        
        .pastel-purple {
            background: linear-gradient(135deg, #d299c2 0%, #fef9d7 100%) !important;
        }
        
        .sunset-theme {
            background: linear-gradient(135deg, #ff9a9e 0%, #fad0c4 100%) !important;
        }
        
        .ocean-theme {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%) !important;
        }
        
        .forest-theme {
            background: linear-gradient(135deg, #d4fc79 0%, #96e6a1 100%) !important;
        }
        
        /* Mobile Responsiveness */
        @media (max-width: 768px) {
            .glass-effect {
                backdrop-filter: blur(8px);
            }
            
            /* Mobile header adjustments */
            #mainApp header {
                padding: 0.75rem;
            }
            
            /* Mobile sidebar */
            .w-80 {
                width: 100%;
                max-width: 320px;
            }
            
            /* Mobile chat area */
            #chatMessages {
                padding: 0.75rem;
            }
            
            /* Mobile modals */
            .max-w-md {
                max-width: calc(100vw - 2rem);
            }
            
            .max-w-2xl {
                max-width: calc(100vw - 2rem);
            }
            
            .max-w-4xl {
                max-width: calc(100vw - 1rem);
            }
            
            /* Mobile text sizes */
            .text-4xl {
                font-size: 2rem;
            }
            
            .text-2xl {
                font-size: 1.5rem;
            }
            
            /* Mobile spacing */
            .p-8 {
                padding: 1.5rem;
            }
            
            .p-6 {
                padding: 1rem;
            }
            
            /* Mobile grid adjustments */
            .grid-cols-3 {
                grid-template-columns: repeat(2, minmax(0, 1fr));
            }
            
            .lg\:grid-cols-3 {
                grid-template-columns: repeat(1, minmax(0, 1fr));
            }
            
            /* Mobile button sizes */
            .p-3 {
                padding: 0.5rem;
            }
            
            /* Mobile input adjustments */
            .px-4.py-3 {
                padding: 0.75rem 1rem;
            }
        }
        
        @media (max-width: 640px) {
            /* Extra small mobile adjustments */
            .space-x-4 > * + * {
                margin-left: 0.5rem;
            }
            
            .space-x-3 > * + * {
                margin-left: 0.5rem;
            }
            
            .space-x-2 > * + * {
                margin-left: 0.25rem;
            }
            
            /* Hide some elements on very small screens */
            .hidden-xs {
                display: none;
            }
            
            /* Adjust font sizes for very small screens */
            .text-xl {
                font-size: 1.125rem;
            }
            
            .text-lg {
                font-size: 1rem;
            }
        }
    </style>
</head>
<body class="min-h-screen pastel-blue">
    <!-- Login Page -->
    <div id="loginPage" class="min-h-screen flex items-center justify-center p-4">
        <div class="glass-effect rounded-3xl p-8 w-full max-w-md shadow-2xl">
            <div class="text-center mb-8">
                <div class="floating mb-4">
                    <div class="w-20 h-20 mx-auto rounded-full pastel-pink flex items-center justify-center relative overflow-hidden cursor-pointer" onclick="cycleLogo()">
                        <div id="logoContainer">
                            <!-- Logo Option 1: Chat Bubbles (Current) -->
                            <svg id="logo1" width="48" height="48" viewBox="0 0 48 48" class="logo-option relative z-10">
                                <path d="M8 12c0-4.4 3.6-8 8-8h12c4.4 0 8 3.6 8 8v8c0 4.4-3.6 8-8 8h-4l-6 6v-6h-2c-4.4 0-8-3.6-8-8v-8z" fill="#667eea" opacity="0.9"/>
                                <path d="M12 20c0-3.3 2.7-6 6-6h12c3.3 0 6 2.7 6 6v6c0 3.3-2.7 6-6 6h-4l-4 4v-4h-4c-3.3 0-6-2.7-6-6v-6z" fill="#764ba2" opacity="0.8"/>
                                <circle cx="20" cy="16" r="1.5" fill="#fff" opacity="0.8"/>
                                <circle cx="26" cy="18" r="1" fill="#fff" opacity="0.6"/>
                                <circle cx="32" cy="24" r="1.5" fill="#fff" opacity="0.9"/>
                                <path d="M22 14l4 2M24 20l6 2" stroke="#fff" stroke-width="1" opacity="0.5" stroke-linecap="round"/>
                            </svg>
                            
                            <!-- Logo Option 2: Modern C Letters -->
                            <svg id="logo2" width="48" height="48" viewBox="0 0 48 48" class="logo-option relative z-10 hidden">
                                <defs>
                                    <linearGradient id="grad1" x1="0%" y1="0%" x2="100%" y2="100%">
                                        <stop offset="0%" style="stop-color:#667eea;stop-opacity:1" />
                                        <stop offset="100%" style="stop-color:#764ba2;stop-opacity:1" />
                                    </linearGradient>
                                </defs>
                                <!-- First C -->
                                <path d="M12 8c-6 0-8 4-8 8v8c0 4 2 8 8 8h4v-4h-4c-2 0-4-2-4-4v-8c0-2 2-4 4-4h4V8h-4z" fill="url(#grad1)" opacity="0.9"/>
                                <!-- Second C -->
                                <path d="M32 12c-6 0-8 4-8 8v8c0 4 2 8 8 8h4v-4h-4c-2 0-4-2-4-4v-8c0-2 2-4 4-4h4v-4h-4z" fill="url(#grad1)" opacity="0.7"/>
                                <!-- Connecting dots -->
                                <circle cx="20" cy="16" r="2" fill="#fff" opacity="0.8"/>
                                <circle cx="28" cy="20" r="2" fill="#fff" opacity="0.6"/>
                                <circle cx="36" cy="24" r="2" fill="#fff" opacity="0.9"/>
                            </svg>
                            
                            <!-- Logo Option 3: Chat Network -->
                            <svg id="logo3" width="48" height="48" viewBox="0 0 48 48" class="logo-option relative z-10 hidden">
                                <!-- Central hub -->
                                <circle cx="24" cy="24" r="8" fill="#667eea" opacity="0.9"/>
                                <!-- Surrounding chat nodes -->
                                <circle cx="12" cy="12" r="4" fill="#764ba2" opacity="0.8"/>
                                <circle cx="36" cy="12" r="4" fill="#764ba2" opacity="0.8"/>
                                <circle cx="12" cy="36" r="4" fill="#764ba2" opacity="0.8"/>
                                <circle cx="36" cy="36" r="4" fill="#764ba2" opacity="0.8"/>
                                <!-- Connection lines -->
                                <line x1="16" y1="16" x2="20" y2="20" stroke="#fff" stroke-width="2" opacity="0.6"/>
                                <line x1="32" y1="16" x2="28" y2="20" stroke="#fff" stroke-width="2" opacity="0.6"/>
                                <line x1="16" y1="32" x2="20" y2="28" stroke="#fff" stroke-width="2" opacity="0.6"/>
                                <line x1="32" y1="32" x2="28" y2="28" stroke="#fff" stroke-width="2" opacity="0.6"/>
                                <!-- Center icon -->
                                <text x="24" y="28" text-anchor="middle" fill="#fff" font-size="12" font-weight="bold">💬</text>
                            </svg>
                            
                            <!-- Logo Option 4: Speech Wave -->
                            <svg id="logo4" width="48" height="48" viewBox="0 0 48 48" class="logo-option relative z-10 hidden">
                                <!-- Sound waves -->
                                <path d="M8 20c4-8 8-8 12 0s8 8 12 0s8-8 12 0" stroke="#667eea" stroke-width="3" fill="none" opacity="0.9"/>
                                <path d="M8 24c4-6 8-6 12 0s8 6 12 0s8-6 12 0" stroke="#764ba2" stroke-width="3" fill="none" opacity="0.8"/>
                                <path d="M8 28c4-4 8-4 12 0s8 4 12 0s8-4 12 0" stroke="#667eea" stroke-width="3" fill="none" opacity="0.7"/>
                                <!-- Chat indicator -->
                                <circle cx="8" cy="24" r="3" fill="#fff" opacity="0.9"/>
                                <circle cx="40" cy="24" r="3" fill="#fff" opacity="0.9"/>
                                <!-- Sparkles -->
                                <circle cx="16" cy="16" r="1" fill="#fff" opacity="0.8"/>
                                <circle cx="32" cy="32" r="1" fill="#fff" opacity="0.8"/>
                                <circle cx="24" cy="12" r="1.5" fill="#fff" opacity="0.9"/>
                            </svg>
                            
                            <!-- Logo Option 5: Hexagon Chat -->
                            <svg id="logo5" width="48" height="48" viewBox="0 0 48 48" class="logo-option relative z-10 hidden">
                                <!-- Hexagon base -->
                                <polygon points="24,4 36,12 36,28 24,36 12,28 12,12" fill="#667eea" opacity="0.9"/>
                                <!-- Inner hexagon -->
                                <polygon points="24,8 32,14 32,26 24,32 16,26 16,14" fill="#764ba2" opacity="0.8"/>
                                <!-- Chat elements -->
                                <circle cx="20" cy="18" r="2" fill="#fff" opacity="0.9"/>
                                <circle cx="28" cy="18" r="2" fill="#fff" opacity="0.9"/>
                                <path d="M18 26c2-2 4-2 6 0s4 2 6 0" stroke="#fff" stroke-width="2" fill="none" opacity="0.8"/>
                                <!-- Corner sparkles -->
                                <circle cx="12" cy="8" r="1" fill="#fff" opacity="0.7"/>
                                <circle cx="36" cy="8" r="1" fill="#fff" opacity="0.7"/>
                                <circle cx="40" cy="24" r="1" fill="#fff" opacity="0.7"/>
                            </svg>
                            
                            <!-- Logo Option 6: Infinity Chat -->
                            <svg id="logo6" width="48" height="48" viewBox="0 0 48 48" class="logo-option relative z-10 hidden">
                                <!-- Infinity symbol -->
                                <path d="M12 24c0-6 4-10 8-10s8 4 8 10-4 10-8 10-8-4-8-10z" fill="#667eea" opacity="0.9"/>
                                <path d="M28 24c0-6 4-10 8-10s8 4 8 10-4 10-8 10-8-4-8-10z" fill="#764ba2" opacity="0.8"/>
                                <!-- Chat dots -->
                                <circle cx="16" cy="20" r="1.5" fill="#fff" opacity="0.9"/>
                                <circle cx="20" cy="24" r="1.5" fill="#fff" opacity="0.7"/>
                                <circle cx="16" cy="28" r="1.5" fill="#fff" opacity="0.9"/>
                                <circle cx="32" cy="20" r="1.5" fill="#fff" opacity="0.9"/>
                                <circle cx="28" cy="24" r="1.5" fill="#fff" opacity="0.7"/>
                                <circle cx="32" cy="28" r="1.5" fill="#fff" opacity="0.9"/>
                                <!-- Connecting sparkles -->
                                <circle cx="24" cy="16" r="1" fill="#fff" opacity="0.6"/>
                                <circle cx="24" cy="32" r="1" fill="#fff" opacity="0.6"/>
                            </svg>
                        </div>
                        <!-- Animated ring -->
                        <div class="absolute inset-0 rounded-full border-2 border-white/30 pulse-ring"></div>
                        <!-- Logo indicator -->
                        <div class="absolute -bottom-2 left-1/2 transform -translate-x-1/2">
                            <div class="flex space-x-1">
                                <div id="indicator1" class="w-2 h-2 rounded-full bg-white/60"></div>
                                <div id="indicator2" class="w-2 h-2 rounded-full bg-white/30"></div>
                                <div id="indicator3" class="w-2 h-2 rounded-full bg-white/30"></div>
                                <div id="indicator4" class="w-2 h-2 rounded-full bg-white/30"></div>
                                <div id="indicator5" class="w-2 h-2 rounded-full bg-white/30"></div>
                                <div id="indicator6" class="w-2 h-2 rounded-full bg-white/30"></div>
                            </div>
                        </div>
                    </div>
                </div>
                <h1 class="text-4xl font-bold text-gray-800 mb-2">ChitChat</h1>
                <p class="text-gray-600">Connect, Chat, Create Memories ✨</p>
            </div>
            
            <form class="space-y-6">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Email</label>
                    <input type="email" id="loginEmail" class="w-full px-4 py-3 rounded-2xl border-0 glass-effect placeholder-gray-500 focus:ring-2 focus:ring-purple-300 focus:outline-none" placeholder="your@email.com">
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Password</label>
                    <input type="password" id="loginPassword" class="w-full px-4 py-3 rounded-2xl border-0 glass-effect placeholder-gray-500 focus:ring-2 focus:ring-purple-300 focus:outline-none" placeholder="••••••••">
                </div>
                
                <button type="button" onclick="login()" class="w-full py-3 rounded-2xl gradient-bg text-white font-semibold hover:opacity-90 transition-all duration-300 transform hover:scale-105">
                    Masuk ke ChitChat 🚀
                </button>
                
                <div class="text-center">
                    <a href="javascript:void(0)" onclick="showForgotPassword()" class="text-sm text-purple-600 hover:text-purple-800 cursor-pointer">Lupa password?</a>
                </div>
            </form>
            
            <div class="mt-6 text-center">
                <p class="text-xs text-gray-500">Belum punya akun? <a href="javascript:void(0)" onclick="showRegister()" class="text-purple-600 hover:text-purple-800 font-medium cursor-pointer">Daftar sekarang</a></p>
            </div>
        </div>
    </div>

    <!-- Register Page -->
    <div id="registerPage" class="hidden min-h-screen flex items-center justify-center p-4">
        <div class="glass-effect rounded-3xl p-8 w-full max-w-md shadow-2xl">
            <div class="text-center mb-8">
                <div class="floating mb-4">
                    <div class="w-20 h-20 mx-auto rounded-full pastel-pink flex items-center justify-center relative overflow-hidden cursor-pointer" onclick="cycleLogo()">
                        <div id="logoContainer">
                            <!-- Logo Option 1: Chat Bubbles (Current) -->
                            <svg id="logo1" width="48" height="48" viewBox="0 0 48 48" class="logo-option relative z-10">
                                <path d="M8 12c0-4.4 3.6-8 8-8h12c4.4 0 8 3.6 8 8v8c0 4.4-3.6 8-8 8h-4l-6 6v-6h-2c-4.4 0-8-3.6-8-8v-8z" fill="#667eea" opacity="0.9"/>
                                <path d="M12 20c0-3.3 2.7-6 6-6h12c3.3 0 6 2.7 6 6v6c0 3.3-2.7 6-6 6h-4l-4 4v-4h-4c-3.3 0-6-2.7-6-6v-6z" fill="#764ba2" opacity="0.8"/>
                                <circle cx="20" cy="16" r="1.5" fill="#fff" opacity="0.8"/>
                                <circle cx="26" cy="18" r="1" fill="#fff" opacity="0.6"/>
                                <circle cx="32" cy="24" r="1.5" fill="#fff" opacity="0.9"/>
                                <path d="M22 14l4 2M24 20l6 2" stroke="#fff" stroke-width="1" opacity="0.5" stroke-linecap="round"/>
                            </svg>
                            
                            <!-- Logo Option 2: Modern C Letters -->
                            <svg id="logo2" width="48" height="48" viewBox="0 0 48 48" class="logo-option relative z-10 hidden">
                                <defs>
                                    <linearGradient id="grad1" x1="0%" y1="0%" x2="100%" y2="100%">
                                        <stop offset="0%" style="stop-color:#667eea;stop-opacity:1" />
                                        <stop offset="100%" style="stop-color:#764ba2;stop-opacity:1" />
                                    </linearGradient>
                                </defs>
                                <!-- First C -->
                                <path d="M12 8c-6 0-8 4-8 8v8c0 4 2 8 8 8h4v-4h-4c-2 0-4-2-4-4v-8c0-2 2-4 4-4h4V8h-4z" fill="url(#grad1)" opacity="0.9"/>
                                <!-- Second C -->
                                <path d="M32 12c-6 0-8 4-8 8v8c0 4 2 8 8 8h4v-4h-4c-2 0-4-2-4-4v-8c0-2 2-4 4-4h4v-4h-4z" fill="url(#grad1)" opacity="0.7"/>
                                <!-- Connecting dots -->
                                <circle cx="20" cy="16" r="2" fill="#fff" opacity="0.8"/>
                                <circle cx="28" cy="20" r="2" fill="#fff" opacity="0.6"/>
                                <circle cx="36" cy="24" r="2" fill="#fff" opacity="0.9"/>
                            </svg>
                            
                            <!-- Logo Option 3: Chat Network -->
                            <svg id="logo3" width="48" height="48" viewBox="0 0 48 48" class="logo-option relative z-10 hidden">
                                <!-- Central hub -->
                                <circle cx="24" cy="24" r="8" fill="#667eea" opacity="0.9"/>
                                <!-- Surrounding chat nodes -->
                                <circle cx="12" cy="12" r="4" fill="#764ba2" opacity="0.8"/>
                                <circle cx="36" cy="12" r="4" fill="#764ba2" opacity="0.8"/>
                                <circle cx="12" cy="36" r="4" fill="#764ba2" opacity="0.8"/>
                                <circle cx="36" cy="36" r="4" fill="#764ba2" opacity="0.8"/>
                                <!-- Connection lines -->
                                <line x1="16" y1="16" x2="20" y2="20" stroke="#fff" stroke-width="2" opacity="0.6"/>
                                <line x1="32" y1="16" x2="28" y2="20" stroke="#fff" stroke-width="2" opacity="0.6"/>
                                <line x1="16" y1="32" x2="20" y2="28" stroke="#fff" stroke-width="2" opacity="0.6"/>
                                <line x1="32" y1="32" x2="28" y2="28" stroke="#fff" stroke-width="2" opacity="0.6"/>
                                <!-- Center icon -->
                                <text x="24" y="28" text-anchor="middle" fill="#fff" font-size="12" font-weight="bold">💬</text>
                            </svg>
                            
                            <!-- Logo Option 4: Speech Wave -->
                            <svg id="logo4" width="48" height="48" viewBox="0 0 48 48" class="logo-option relative z-10 hidden">
                                <!-- Sound waves -->
                                <path d="M8 20c4-8 8-8 12 0s8 8 12 0s8-8 12 0" stroke="#667eea" stroke-width="3" fill="none" opacity="0.9"/>
                                <path d="M8 24c4-6 8-6 12 0s8 6 12 0s8-6 12 0" stroke="#764ba2" stroke-width="3" fill="none" opacity="0.8"/>
                                <path d="M8 28c4-4 8-4 12 0s8 4 12 0s8-4 12 0" stroke="#667eea" stroke-width="3" fill="none" opacity="0.7"/>
                                <!-- Chat indicator -->
                                <circle cx="8" cy="24" r="3" fill="#fff" opacity="0.9"/>
                                <circle cx="40" cy="24" r="3" fill="#fff" opacity="0.9"/>
                                <!-- Sparkles -->
                                <circle cx="16" cy="16" r="1" fill="#fff" opacity="0.8"/>
                                <circle cx="32" cy="32" r="1" fill="#fff" opacity="0.8"/>
                                <circle cx="24" cy="12" r="1.5" fill="#fff" opacity="0.9"/>
                            </svg>
                            
                            <!-- Logo Option 5: Hexagon Chat -->
                            <svg id="logo5" width="48" height="48" viewBox="0 0 48 48" class="logo-option relative z-10 hidden">
                                <!-- Hexagon base -->
                                <polygon points="24,4 36,12 36,28 24,36 12,28 12,12" fill="#667eea" opacity="0.9"/>
                                <!-- Inner hexagon -->
                                <polygon points="24,8 32,14 32,26 24,32 16,26 16,14" fill="#764ba2" opacity="0.8"/>
                                <!-- Chat elements -->
                                <circle cx="20" cy="18" r="2" fill="#fff" opacity="0.9"/>
                                <circle cx="28" cy="18" r="2" fill="#fff" opacity="0.9"/>
                                <path d="M18 26c2-2 4-2 6 0s4 2 6 0" stroke="#fff" stroke-width="2" fill="none" opacity="0.8"/>
                                <!-- Corner sparkles -->
                                <circle cx="12" cy="8" r="1" fill="#fff" opacity="0.7"/>
                                <circle cx="36" cy="8" r="1" fill="#fff" opacity="0.7"/>
                                <circle cx="40" cy="24" r="1" fill="#fff" opacity="0.7"/>
                            </svg>
                            
                            <!-- Logo Option 6: Infinity Chat -->
                            <svg id="logo6" width="48" height="48" viewBox="0 0 48 48" class="logo-option relative z-10 hidden">
                                <!-- Infinity symbol -->
                                <path d="M12 24c0-6 4-10 8-10s8 4 8 10-4 10-8 10-8-4-8-10z" fill="#667eea" opacity="0.9"/>
                                <path d="M28 24c0-6 4-10 8-10s8 4 8 10-4 10-8 10-8-4-8-10z" fill="#764ba2" opacity="0.8"/>
                                <!-- Chat dots -->
                                <circle cx="16" cy="20" r="1.5" fill="#fff" opacity="0.9"/>
                                <circle cx="20" cy="24" r="1.5" fill="#fff" opacity="0.7"/>
                                <circle cx="16" cy="28" r="1.5" fill="#fff" opacity="0.9"/>
                                <circle cx="32" cy="20" r="1.5" fill="#fff" opacity="0.9"/>
                                <circle cx="28" cy="24" r="1.5" fill="#fff" opacity="0.7"/>
                                <circle cx="32" cy="28" r="1.5" fill="#fff" opacity="0.9"/>
                                <!-- Connecting sparkles -->
                                <circle cx="24" cy="16" r="1" fill="#fff" opacity="0.6"/>
                                <circle cx="24" cy="32" r="1" fill="#fff" opacity="0.6"/>
                            </svg>
                        </div>
                        <!-- Animated ring -->
                        <div class="absolute inset-0 rounded-full border-2 border-white/30 pulse-ring"></div>
                        <!-- Logo indicator -->
                        <div class="absolute -bottom-2 left-1/2 transform -translate-x-1/2">
                            <div class="flex space-x-1">
                                <div id="indicator1" class="w-2 h-2 rounded-full bg-white/60"></div>
                                <div id="indicator2" class="w-2 h-2 rounded-full bg-white/30"></div>
                                <div id="indicator3" class="w-2 h-2 rounded-full bg-white/30"></div>
                                <div id="indicator4" class="w-2 h-2 rounded-full bg-white/30"></div>
                                <div id="indicator5" class="w-2 h-2 rounded-full bg-white/30"></div>
                                <div id="indicator6" class="w-2 h-2 rounded-full bg-white/30"></div>
                            </div>
                        </div>
                    </div>
                </div>
                <h1 class="text-4xl font-bold text-gray-800 mb-2">Daftar ChitChat</h1>
                <p class="text-gray-600">Bergabung dengan komunitas ChitChat ✨</p>
            </div>
            
            <form class="space-y-6">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Nama Lengkap</label>
                    <input type="text" id="registerName" class="w-full px-4 py-3 rounded-2xl border-0 glass-effect placeholder-gray-500 focus:ring-2 focus:ring-purple-300 focus:outline-none" placeholder="Nama lengkap Anda">
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Email</label>
                    <input type="email" id="registerEmail" class="w-full px-4 py-3 rounded-2xl border-0 glass-effect placeholder-gray-500 focus:ring-2 focus:ring-purple-300 focus:outline-none" placeholder="your@email.com">
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Password</label>
                    <input type="password" id="registerPassword" class="w-full px-4 py-3 rounded-2xl border-0 glass-effect placeholder-gray-500 focus:ring-2 focus:ring-purple-300 focus:outline-none" placeholder="••••••••">
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Konfirmasi Password</label>
                    <input type="password" id="confirmPassword" class="w-full px-4 py-3 rounded-2xl border-0 glass-effect placeholder-gray-500 focus:ring-2 focus:ring-purple-300 focus:outline-none" placeholder="••••••••">
                </div>
                
                <div class="flex items-center space-x-2">
                    <input type="checkbox" id="agreeTerms" class="w-4 h-4 text-purple-600 rounded focus:ring-purple-300">
                    <label class="text-sm text-gray-700">Saya setuju dengan <a href="#" class="text-purple-600 hover:text-purple-800">syarat dan ketentuan</a></label>
                </div>
                
                <button type="button" onclick="register()" class="w-full py-3 rounded-2xl gradient-bg text-white font-semibold hover:opacity-90 transition-all duration-300 transform hover:scale-105">
                    Daftar Sekarang 🚀
                </button>
            </form>
            
            <div class="mt-6 text-center">
                <p class="text-xs text-gray-500">Sudah punya akun? <a href="javascript:void(0)" onclick="showLogin()" class="text-purple-600 hover:text-purple-800 font-medium cursor-pointer">Masuk di sini</a></p>
            </div>
        </div>
    </div>

    <!-- Forgot Password Page -->
    <div id="forgotPasswordPage" class="hidden min-h-screen flex items-center justify-center p-4">
        <div class="glass-effect rounded-3xl p-8 w-full max-w-md shadow-2xl">
            <div class="text-center mb-8">
                <div class="floating mb-4">
                    <div class="w-20 h-20 mx-auto rounded-full pastel-pink flex items-center justify-center relative overflow-hidden">
                        <svg width="48" height="48" viewBox="0 0 48 48" class="relative z-10">
                            <!-- Key body -->
                            <rect x="8" y="20" width="20" height="8" rx="4" fill="#667eea" opacity="0.9"/>
                            <!-- Key teeth -->
                            <rect x="28" y="22" width="4" height="2" fill="#667eea" opacity="0.9"/>
                            <rect x="28" y="25" width="6" height="2" fill="#667eea" opacity="0.9"/>
                            <!-- Lock -->
                            <rect x="32" y="18" width="8" height="12" rx="2" fill="#764ba2" opacity="0.8"/>
                            <path d="M34 18v-2c0-2.2 1.8-4 4-4s4 1.8 4 4v2" stroke="#764ba2" stroke-width="2" fill="none" opacity="0.8"/>
                            <!-- Sparkles -->
                            <circle cx="16" cy="16" r="1" fill="#fff" opacity="0.8"/>
                            <circle cx="24" cy="32" r="1.5" fill="#fff" opacity="0.6"/>
                            <circle cx="40" cy="14" r="1" fill="#fff" opacity="0.9"/>
                        </svg>
                        <div class="absolute inset-0 rounded-full border-2 border-white/30 pulse-ring"></div>
                    </div>
                </div>
                <h1 class="text-4xl font-bold text-gray-800 mb-2">Lupa Password</h1>
                <p class="text-gray-600">Kami akan kirim link reset ke email Anda</p>
            </div>
            
            <form class="space-y-6">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Email</label>
                    <input type="email" id="forgotEmail" class="w-full px-4 py-3 rounded-2xl border-0 glass-effect placeholder-gray-500 focus:ring-2 focus:ring-purple-300 focus:outline-none" placeholder="your@email.com">
                </div>
                
                <button type="button" onclick="sendResetLink()" class="w-full py-3 rounded-2xl gradient-bg text-white font-semibold hover:opacity-90 transition-all duration-300 transform hover:scale-105">
                    Kirim Link Reset 📧
                </button>
            </form>
            
            <div class="mt-6 text-center">
                <p class="text-xs text-gray-500">Ingat password? <a href="javascript:void(0)" onclick="showLogin()" class="text-purple-600 hover:text-purple-800 font-medium cursor-pointer">Kembali ke login</a></p>
            </div>
        </div>
    </div>

    <!-- Main App -->
    <div id="mainApp" class="hidden min-h-screen">
        <!-- Header -->
        <header class="glass-effect border-b border-white/20 p-4">
            <div class="flex items-center justify-between">
                <!-- Logo & Brand -->
                <div class="flex items-center space-x-3">
                    <div class="w-10 h-10 rounded-full pastel-pink flex items-center justify-center relative overflow-hidden cursor-pointer" onclick="cycleLogo()">
                        <div id="headerLogoContainer">
                            <svg id="headerLogo1" width="24" height="24" viewBox="0 0 48 48" class="header-logo-option relative z-10">
                                <path d="M8 12c0-4.4 3.6-8 8-8h12c4.4 0 8 3.6 8 8v8c0 4.4-3.6 8-8 8h-4l-6 6v-6h-2c-4.4 0-8-3.6-8-8v-8z" fill="#667eea" opacity="0.9"/>
                                <path d="M12 20c0-3.3 2.7-6 6-6h12c3.3 0 6 2.7 6 6v6c0 3.3-2.7 6-6 6h-4l-4 4v-4h-4c-3.3 0-6-2.7-6-6v-6z" fill="#764ba2" opacity="0.8"/>
                                <circle cx="20" cy="16" r="1" fill="#fff" opacity="0.8"/>
                                <circle cx="26" cy="18" r="0.8" fill="#fff" opacity="0.6"/>
                                <circle cx="32" cy="24" r="1" fill="#fff" opacity="0.9"/>
                            </svg>
                            <svg id="headerLogo2" width="24" height="24" viewBox="0 0 48 48" class="header-logo-option relative z-10 hidden">
                                <path d="M12 8c-6 0-8 4-8 8v8c0 4 2 8 8 8h4v-4h-4c-2 0-4-2-4-4v-8c0-2 2-4 4-4h4V8h-4z" fill="#667eea" opacity="0.9"/>
                                <path d="M32 12c-6 0-8 4-8 8v8c0 4 2 8 8 8h4v-4h-4c-2 0-4-2-4-4v-8c0-2 2-4 4-4h4v-4h-4z" fill="#764ba2" opacity="0.7"/>
                                <circle cx="20" cy="16" r="1" fill="#fff" opacity="0.8"/>
                                <circle cx="28" cy="20" r="1" fill="#fff" opacity="0.6"/>
                                <circle cx="36" cy="24" r="1" fill="#fff" opacity="0.9"/>
                            </svg>
                            <svg id="headerLogo3" width="24" height="24" viewBox="0 0 48 48" class="header-logo-option relative z-10 hidden">
                                <circle cx="24" cy="24" r="4" fill="#667eea" opacity="0.9"/>
                                <circle cx="12" cy="12" r="2" fill="#764ba2" opacity="0.8"/>
                                <circle cx="36" cy="12" r="2" fill="#764ba2" opacity="0.8"/>
                                <circle cx="12" cy="36" r="2" fill="#764ba2" opacity="0.8"/>
                                <circle cx="36" cy="36" r="2" fill="#764ba2" opacity="0.8"/>
                                <line x1="16" y1="16" x2="20" y2="20" stroke="#fff" stroke-width="1" opacity="0.6"/>
                                <line x1="32" y1="16" x2="28" y2="20" stroke="#fff" stroke-width="1" opacity="0.6"/>
                                <line x1="16" y1="32" x2="20" y2="28" stroke="#fff" stroke-width="1" opacity="0.6"/>
                                <line x1="32" y1="32" x2="28" y2="28" stroke="#fff" stroke-width="1" opacity="0.6"/>
                            </svg>
                            <svg id="headerLogo4" width="24" height="24" viewBox="0 0 48 48" class="header-logo-option relative z-10 hidden">
                                <path d="M8 20c4-4 8-4 12 0s8 4 12 0s8-4 12 0" stroke="#667eea" stroke-width="2" fill="none" opacity="0.9"/>
                                <path d="M8 24c4-3 8-3 12 0s8 3 12 0s8-3 12 0" stroke="#764ba2" stroke-width="2" fill="none" opacity="0.8"/>
                                <path d="M8 28c4-2 8-2 12 0s8 2 12 0s8-2 12 0" stroke="#667eea" stroke-width="2" fill="none" opacity="0.7"/>
                                <circle cx="8" cy="24" r="1.5" fill="#fff" opacity="0.9"/>
                                <circle cx="40" cy="24" r="1.5" fill="#fff" opacity="0.9"/>
                            </svg>
                            <svg id="headerLogo5" width="24" height="24" viewBox="0 0 48 48" class="header-logo-option relative z-10 hidden">
                                <polygon points="24,8 30,14 30,22 24,28 18,22 18,14" fill="#667eea" opacity="0.9"/>
                                <polygon points="24,12 28,16 28,20 24,24 20,20 20,16" fill="#764ba2" opacity="0.8"/>
                                <circle cx="22" cy="18" r="1" fill="#fff" opacity="0.9"/>
                                <circle cx="26" cy="18" r="1" fill="#fff" opacity="0.9"/>
                                <path d="M20 22c1-1 2-1 3 0s2 1 3 0" stroke="#fff" stroke-width="1" fill="none" opacity="0.8"/>
                            </svg>
                            <svg id="headerLogo6" width="24" height="24" viewBox="0 0 48 48" class="header-logo-option relative z-10 hidden">
                                <path d="M16 24c0-3 2-5 4-5s4 2 4 5-2 5-4 5-4-2-4-5z" fill="#667eea" opacity="0.9"/>
                                <path d="M28 24c0-3 2-5 4-5s4 2 4 5-2 5-4 5-4-2-4-5z" fill="#764ba2" opacity="0.8"/>
                                <circle cx="18" cy="22" r="0.8" fill="#fff" opacity="0.9"/>
                                <circle cx="20" cy="24" r="0.8" fill="#fff" opacity="0.7"/>
                                <circle cx="18" cy="26" r="0.8" fill="#fff" opacity="0.9"/>
                                <circle cx="30" cy="22" r="0.8" fill="#fff" opacity="0.9"/>
                                <circle cx="28" cy="24" r="0.8" fill="#fff" opacity="0.7"/>
                                <circle cx="30" cy="26" r="0.8" fill="#fff" opacity="0.9"/>
                            </svg>
                        </div>
                    </div>
                    <h1 class="text-xl font-bold text-gray-800">ChitChat</h1>
                </div>
                
                <!-- Navigation Tools -->
                <div class="flex items-center space-x-2">
                    <!-- Quick Actions -->
                    <div class="flex items-center space-x-1">
                        <button onclick="openMeetingScheduler()" class="p-2 rounded-lg hover:bg-white/20 transition-colors" title="Meeting Scheduler">
                            <span class="text-lg">📅</span>
                        </button>
                        <button onclick="openStories()" class="p-2 rounded-lg hover:bg-white/20 transition-colors" title="Stories">
                            <span class="text-lg">📸</span>
                        </button>
                        <button onclick="openGames()" class="p-2 rounded-lg hover:bg-white/20 transition-colors" title="Mini Games">
                            <span class="text-lg">🎮</span>
                        </button>
                        <button onclick="openMusicPlayer()" class="p-2 rounded-lg hover:bg-white/20 transition-colors" title="Music Player">
                            <span class="text-lg">🎵</span>
                        </button>
                        <button onclick="openAIAssistant()" class="p-2 rounded-lg hover:bg-white/20 transition-colors" title="AI Assistant">
                            <span class="text-lg">🤖</span>
                        </button>
                    </div>
                    
                    <!-- Divider -->
                    <div class="w-px h-6 bg-white/20"></div>
                    
                    <!-- User Section -->
                    <div class="flex items-center space-x-2">
                        <!-- User Profile -->
                        <div class="flex items-center space-x-2">
                            <div class="w-8 h-8 rounded-full bg-green-400 relative">
                                <div id="typingIndicator" class="hidden absolute -top-1 -right-1 w-3 h-3 bg-blue-400 rounded-full animate-pulse"></div>
                            </div>
                            <div class="hidden md:block">
                                <div class="text-sm font-medium text-gray-700" id="userDisplayName">User</div>
                                <div class="text-xs text-gray-500" id="userEmail">user@chitchat.com</div>
                            </div>
                        </div>
                        
                        <!-- Settings & Actions -->
                        <div class="flex items-center space-x-1">
                            <button onclick="toggleEasterEgg()" class="p-2 rounded-lg hover:bg-white/20 transition-colors" title="Theme">
                                <span class="text-lg">🎨</span>
                            </button>
                            <button onclick="openSettings()" class="p-2 rounded-lg hover:bg-white/20 transition-colors" title="Pengaturan">
                                <span class="text-lg">⚙️</span>
                            </button>
                            <button onclick="logout()" class="p-2 rounded-lg hover:bg-white/20 transition-colors text-red-500" title="Keluar">
                                <span class="text-lg">🚪</span>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </header>

        <div class="flex flex-col md:flex-row h-screen">
            <!-- Mobile Menu Toggle -->
            <div class="md:hidden p-4 border-b border-white/20 glass-effect">
                <button onclick="toggleMobileSidebar()" id="mobileMenuBtn" class="flex items-center space-x-2 text-gray-700">
                    <span class="text-xl">☰</span>
                    <span class="font-medium">Menu</span>
                </button>
            </div>
            
            <!-- Sidebar -->
            <div id="sidebar" class="w-full md:w-80 glass-effect border-r border-white/20 flex flex-col hidden md:flex">
                <!-- Navigation -->
                <div class="p-3 md:p-4 border-b border-white/20">
                    <div class="flex space-x-2">
                        <button onclick="showTab('rooms')" id="roomsTab" class="flex-1 py-2 px-3 md:px-4 rounded-xl bg-white/30 text-gray-700 font-medium transition-all text-sm md:text-base">
                            🏠 <span class="hidden sm:inline">Rooms</span>
                        </button>
                        <button onclick="showTab('friends')" id="friendsTab" class="flex-1 py-2 px-3 md:px-4 rounded-xl hover:bg-white/20 text-gray-600 font-medium transition-all text-sm md:text-base">
                            👥 <span class="hidden sm:inline">Teman</span>
                        </button>
                    </div>
                </div>

                <!-- Rooms Tab -->
                <div id="roomsContent" class="flex-1 overflow-y-auto p-3 md:p-4">
                    <div class="space-y-3">
                        <div onclick="joinRoom('general'); closeMobileSidebar()" class="p-3 md:p-4 rounded-2xl glass-effect hover:bg-white/30 cursor-pointer transition-all transform hover:scale-105">
                            <div class="flex items-center space-x-3">
                                <div class="w-10 h-10 md:w-12 md:h-12 rounded-full pastel-pink flex items-center justify-center text-lg md:text-xl">🌟</div>
                                <div>
                                    <h3 class="font-semibold text-gray-800 text-sm md:text-base">General Chat</h3>
                                    <p class="text-xs md:text-sm text-gray-600">1 online • Kamu</p>
                                </div>
                            </div>
                        </div>
                        
                        <div onclick="joinRoom('study'); closeMobileSidebar()" class="p-3 md:p-4 rounded-2xl glass-effect hover:bg-white/30 cursor-pointer transition-all transform hover:scale-105">
                            <div class="flex items-center space-x-3">
                                <div class="w-10 h-10 md:w-12 md:h-12 rounded-full pastel-purple flex items-center justify-center text-lg md:text-xl">📚</div>
                                <div>
                                    <h3 class="font-semibold text-gray-800 text-sm md:text-base">Study Group</h3>
                                    <p class="text-xs md:text-sm text-gray-600">1 online • Kamu</p>
                                </div>
                            </div>
                        </div>
                        
                        <div onclick="joinRoom('gaming'); closeMobileSidebar()" class="p-3 md:p-4 rounded-2xl glass-effect hover:bg-white/30 cursor-pointer transition-all transform hover:scale-105">
                            <div class="flex items-center space-x-3">
                                <div class="w-10 h-10 md:w-12 md:h-12 rounded-full gradient-bg flex items-center justify-center text-lg md:text-xl">🎮</div>
                                <div>
                                    <h3 class="font-semibold text-gray-800 text-sm md:text-base">Gaming Zone</h3>
                                    <p class="text-xs md:text-sm text-gray-600">1 online • Kamu</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <button onclick="createRoom()" class="w-full mt-4 py-2 md:py-3 rounded-2xl border-2 border-dashed border-purple-300 text-purple-600 hover:bg-purple-50 transition-all text-sm md:text-base">
                        + Buat Room Baru
                    </button>
                </div>

                <!-- Friends Tab -->
                <div id="friendsContent" class="hidden flex-1 overflow-y-auto p-3 md:p-4">
                    <div class="text-center py-8 md:py-12">
                        <div class="text-4xl md:text-6xl mb-4">👥</div>
                        <h3 class="text-base md:text-lg font-semibold text-gray-700 mb-2">Belum Ada Teman</h3>
                        <p class="text-sm md:text-base text-gray-500 mb-6">Tambahkan teman untuk mulai chat dan video call!</p>
                        <button onclick="addFriend()" class="px-4 md:px-6 py-2 md:py-3 rounded-2xl gradient-bg text-white hover:opacity-90 transition-all transform hover:scale-105 text-sm md:text-base">
                            + Tambah Teman Pertama
                        </button>
                    </div>
                </div>
            </div>

            <!-- Main Chat Area -->
            <div class="flex-1 flex flex-col">
                <!-- Chat Header -->
                <div id="chatHeader" class="p-3 md:p-4 border-b border-white/20 glass-effect">
                    <div class="flex items-center justify-between">
                        <div class="flex items-center space-x-2 md:space-x-4">
                            <div class="w-10 h-10 md:w-12 md:h-12 rounded-full pastel-pink flex items-center justify-center text-lg md:text-xl">🌟</div>
                            <div>
                                <h2 class="text-lg md:text-xl font-bold text-gray-800" id="roomTitle">General Chat</h2>
                                <p class="text-xs md:text-sm text-gray-600" id="roomMembers">1 member online</p>
                            </div>
                        </div>
                        
                        <div class="flex items-center space-x-1 md:space-x-2">
                            <button onclick="inviteFriendsToRoom()" class="p-2 md:p-3 rounded-full glass-effect hover:bg-white/30 transition-all" title="Undang Teman">
                                <span class="text-lg md:text-xl">👥</span>
                            </button>
                            <button onclick="toggleCamera()" id="cameraBtn" class="p-2 md:p-3 rounded-full glass-effect hover:bg-white/30 transition-all">
                                <span class="text-lg md:text-xl">📹</span>
                            </button>
                            <button onclick="shareScreen()" id="shareScreenBtn" class="p-2 md:p-3 rounded-full glass-effect hover:bg-white/30 transition-all" title="Bagikan Layar">
                                <span class="text-lg md:text-xl">🖥️</span>
                            </button>
                            <button onclick="toggleMic()" id="micBtn" class="p-2 md:p-3 rounded-full glass-effect hover:bg-white/30 transition-all">
                                <span class="text-lg md:text-xl">🎤</span>
                            </button>
                            <button onclick="shareScreen()" class="p-2 md:p-3 rounded-full glass-effect hover:bg-white/30 transition-all hidden sm:block">
                                <span class="text-lg md:text-xl">🖥️</span>
                            </button>
                            <button onclick="openWhiteboard()" class="p-2 md:p-3 rounded-full glass-effect hover:bg-white/30 transition-all hidden sm:block">
                                <span class="text-lg md:text-xl">✏️</span>
                            </button>
                            <button onclick="uploadFile()" class="p-2 md:p-3 rounded-full glass-effect hover:bg-white/30 transition-all">
                                <span class="text-lg md:text-xl">📎</span>
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Video Call Area -->
                <div id="videoArea" class="hidden p-4 border-b border-white/20">
                    <div class="grid grid-cols-2 gap-4">
                        <div class="aspect-video rounded-2xl glass-effect flex items-center justify-center">
                            <div class="text-center">
                                <div class="text-6xl mb-2">📹</div>
                                <p class="text-gray-600">Kamera Anda</p>
                                <p class="text-xs text-gray-500">(Demo Mode)</p>
                            </div>
                        </div>
                        <div class="aspect-video rounded-2xl glass-effect flex items-center justify-center">
                            <div class="text-center">
                                <div class="text-6xl mb-2">👤</div>
                                <p class="text-gray-600">Teman</p>
                                <p class="text-xs text-gray-500">(Demo Mode)</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Chat Messages -->
                <div id="chatMessages" class="flex-1 overflow-y-auto p-4 space-y-4">
                    <div class="text-center py-12">
                        <div class="text-6xl mb-4">💬</div>
                        <h3 class="text-lg font-semibold text-gray-700 mb-2">Mulai Percakapan</h3>
                        <p class="text-gray-500 mb-6">Kirim pesan pertama untuk memulai chat di room ini!</p>
                    </div>
                </div>

                <!-- Message Input -->
                <div class="p-3 md:p-4 border-t border-white/20">
                    <div class="flex items-center space-x-2 md:space-x-4">
                        <button onclick="addEmoji()" class="p-2 rounded-full hover:bg-white/20 transition-colors">
                            <span class="text-lg md:text-xl">😊</span>
                        </button>
                        <div class="flex-1 relative">
                            <input type="text" id="messageInput" placeholder="Ketik pesan..." class="w-full px-3 md:px-4 py-2 md:py-3 rounded-2xl glass-effect border-0 focus:ring-2 focus:ring-purple-300 focus:outline-none text-sm md:text-base" onkeypress="handleEnter(event)" oninput="showTypingIndicator()">
                        </div>
                        <button onclick="sendVoiceMessage()" class="p-2 rounded-full hover:bg-white/20 transition-colors hidden sm:block" title="Voice Message">
                            <span class="text-lg md:text-xl">🎤</span>
                        </button>
                        <button onclick="createPoll()" class="p-2 rounded-full hover:bg-white/20 transition-colors hidden sm:block" title="Create Poll">
                            <span class="text-lg md:text-xl">📊</span>
                        </button>
                        <button onclick="sendMessage()" class="p-2 md:p-3 rounded-full gradient-bg text-white hover:opacity-90 transition-all transform hover:scale-105">
                            <span class="text-lg md:text-xl">🚀</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modals -->
    <!-- Add Friend Modal -->
    <div id="addFriendModal" class="hidden fixed inset-0 bg-black/50 flex items-center justify-center z-50">
        <div class="glass-effect rounded-3xl p-6 w-full max-w-md mx-4">
            <h3 class="text-xl font-bold text-gray-800 mb-4">Tambah Teman Baru</h3>
            <input type="email" id="friendEmail" placeholder="Email teman" class="w-full px-4 py-3 rounded-2xl glass-effect border-0 mb-4 focus:ring-2 focus:ring-purple-300 focus:outline-none">
            <div class="flex space-x-3">
                <button onclick="closeModal('addFriendModal')" class="flex-1 py-2 px-4 rounded-xl border border-gray-300 text-gray-700 hover:bg-gray-50">Batal</button>
                <button onclick="sendFriendRequest()" class="flex-1 py-2 px-4 rounded-xl gradient-bg text-white hover:opacity-90">Kirim Undangan</button>
            </div>
        </div>
    </div>

    <!-- Create Room Modal -->
    <div id="createRoomModal" class="hidden fixed inset-0 bg-black/50 flex items-center justify-center z-50">
        <div class="glass-effect rounded-3xl p-6 w-full max-w-md mx-4">
            <h3 class="text-xl font-bold text-gray-800 mb-4">Buat Room Baru</h3>
            <input type="text" id="roomName" placeholder="Nama room" class="w-full px-4 py-3 rounded-2xl glass-effect border-0 mb-4 focus:ring-2 focus:ring-purple-300 focus:outline-none">
            <textarea id="roomDescription" placeholder="Deskripsi room (opsional)" class="w-full px-4 py-3 rounded-2xl glass-effect border-0 mb-4 focus:ring-2 focus:ring-purple-300 focus:outline-none h-20 resize-none"></textarea>
            <div class="flex space-x-3">
                <button onclick="closeModal('createRoomModal')" class="flex-1 py-2 px-4 rounded-xl border border-gray-300 text-gray-700 hover:bg-gray-50">Batal</button>
                <button onclick="createNewRoom()" class="flex-1 py-2 px-4 rounded-xl gradient-bg text-white hover:opacity-90">Buat Room</button>
            </div>
        </div>
    </div>

    <!-- File Upload Modal -->
    <div id="fileUploadModal" class="hidden fixed inset-0 bg-black/50 flex items-center justify-center z-50">
        <div class="glass-effect rounded-3xl p-6 w-full max-w-md mx-4">
            <h3 class="text-xl font-bold text-gray-800 mb-4">Upload File</h3>
            <div class="border-2 border-dashed border-purple-300 rounded-2xl p-8 text-center mb-4">
                <div class="text-4xl mb-2">📎</div>
                <p class="text-gray-600 mb-2">Drag & drop file atau klik untuk pilih</p>
                <input type="file" id="fileInput" class="hidden" multiple>
                <button onclick="document.getElementById('fileInput').click()" class="px-4 py-2 rounded-xl gradient-bg text-white text-sm hover:opacity-90">Pilih File</button>
            </div>
            <div class="flex space-x-3">
                <button onclick="closeModal('fileUploadModal')" class="flex-1 py-2 px-4 rounded-xl border border-gray-300 text-gray-700 hover:bg-gray-50">Batal</button>
                <button onclick="uploadSelectedFile()" class="flex-1 py-2 px-4 rounded-xl gradient-bg text-white hover:opacity-90">Upload</button>
            </div>
        </div>
    </div>

    <!-- Whiteboard Modal -->
    <div id="whiteboardModal" class="hidden fixed inset-0 bg-black/50 flex items-center justify-center z-50">
        <div class="glass-effect rounded-3xl p-6 w-full max-w-4xl mx-4 h-5/6">
            <div class="flex items-center justify-between mb-4">
                <h3 class="text-xl font-bold text-gray-800">Whiteboard Kolaboratif</h3>
                <button onclick="closeModal('whiteboardModal')" class="p-2 rounded-full hover:bg-white/20">✕</button>
            </div>
            <div class="bg-white rounded-2xl h-full flex items-center justify-center">
                <div class="text-center">
                    <div class="text-6xl mb-4">✏️</div>
                    <p class="text-gray-600 text-lg">Whiteboard Demo</p>
                    <p class="text-gray-500">Fitur whiteboard interaktif akan tersedia di sini</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Meeting Scheduler Modal -->
    <div id="meetingModal" class="hidden fixed inset-0 bg-black/50 flex items-center justify-center z-50">
        <div class="glass-effect rounded-3xl p-6 w-full max-w-2xl mx-4 max-h-5/6 overflow-y-auto">
            <div class="flex items-center justify-between mb-6">
                <h3 class="text-2xl font-bold text-gray-800">📅 Jadwalkan Pertemuan</h3>
                <button onclick="closeModal('meetingModal')" class="p-2 rounded-full hover:bg-white/20">✕</button>
            </div>
            
            <div class="space-y-6">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Judul Meeting</label>
                        <input type="text" id="meetingTitle" placeholder="Contoh: Team Standup" class="w-full px-4 py-3 rounded-2xl glass-effect border-0 focus:ring-2 focus:ring-purple-300 focus:outline-none">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Tipe Meeting</label>
                        <select id="meetingType" class="w-full px-4 py-3 rounded-2xl glass-effect border-0 focus:ring-2 focus:ring-purple-300 focus:outline-none">
                            <option value="video">📹 Video Call</option>
                            <option value="audio">🎤 Audio Call</option>
                            <option value="chat">💬 Chat Meeting</option>
                            <option value="physical">🏢 Pertemuan Fisik</option>
                        </select>
                    </div>
                </div>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Tanggal</label>
                        <input type="date" id="meetingDate" class="w-full px-4 py-3 rounded-2xl glass-effect border-0 focus:ring-2 focus:ring-purple-300 focus:outline-none">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Waktu</label>
                        <input type="time" id="meetingTime" class="w-full px-4 py-3 rounded-2xl glass-effect border-0 focus:ring-2 focus:ring-purple-300 focus:outline-none">
                    </div>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Durasi</label>
                    <select id="meetingDuration" class="w-full px-4 py-3 rounded-2xl glass-effect border-0 focus:ring-2 focus:ring-purple-300 focus:outline-none">
                        <option value="15">15 menit</option>
                        <option value="30" selected>30 menit</option>
                        <option value="60">1 jam</option>
                        <option value="90">1.5 jam</option>
                        <option value="120">2 jam</option>
                        <option value="custom">Custom</option>
                    </select>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Deskripsi & Agenda</label>
                    <textarea id="meetingDescription" placeholder="Jelaskan tujuan meeting dan agenda yang akan dibahas..." class="w-full px-4 py-3 rounded-2xl glass-effect border-0 focus:ring-2 focus:ring-purple-300 focus:outline-none h-24 resize-none"></textarea>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Undang Peserta</label>
                    <div class="flex space-x-2 mb-2">
                        <input type="email" id="participantEmail" placeholder="Email peserta" class="flex-1 px-4 py-2 rounded-xl glass-effect border-0 focus:ring-2 focus:ring-purple-300 focus:outline-none">
                        <button onclick="addParticipant()" class="px-4 py-2 rounded-xl gradient-bg text-white hover:opacity-90">Tambah</button>
                    </div>
                    <div id="participantsList" class="space-y-2 max-h-32 overflow-y-auto"></div>
                </div>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Reminder</label>
                        <select id="meetingReminder" class="w-full px-4 py-3 rounded-2xl glass-effect border-0 focus:ring-2 focus:ring-purple-300 focus:outline-none">
                            <option value="0">Tidak ada reminder</option>
                            <option value="5">5 menit sebelum</option>
                            <option value="15" selected>15 menit sebelum</option>
                            <option value="30">30 menit sebelum</option>
                            <option value="60">1 jam sebelum</option>
                            <option value="1440">1 hari sebelum</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Lokasi/Link</label>
                        <input type="text" id="meetingLocation" placeholder="Zoom link, alamat, atau ruangan" class="w-full px-4 py-3 rounded-2xl glass-effect border-0 focus:ring-2 focus:ring-purple-300 focus:outline-none">
                    </div>
                </div>
            </div>
            
            <div class="flex space-x-3 mt-6">
                <button onclick="closeModal('meetingModal')" class="flex-1 py-3 px-4 rounded-xl border border-gray-300 text-gray-700 hover:bg-gray-50">Batal</button>
                <button onclick="scheduleMeeting()" class="flex-1 py-3 px-4 rounded-xl gradient-bg text-white hover:opacity-90">📅 Jadwalkan Meeting</button>
            </div>
        </div>
    </div>

    <!-- Settings Modal -->
    <div id="settingsModal" class="hidden fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4">
        <div class="glass-effect rounded-3xl p-6 w-full max-w-4xl h-full max-h-[90vh] overflow-hidden flex flex-col">
            <div class="flex items-center justify-between mb-6 flex-shrink-0">
                <h3 class="text-2xl font-bold text-gray-800">⚙️ Pengaturan</h3>
                <button onclick="closeModal('settingsModal')" class="p-2 rounded-full hover:bg-white/20">✕</button>
            </div>
            
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 overflow-y-auto flex-1 pr-2">
                <!-- Profile Settings -->
                <div class="space-y-6">
                    <div class="glass-effect rounded-2xl p-6">
                        <h4 class="text-lg font-semibold text-gray-800 mb-4 flex items-center">
                            <span class="text-2xl mr-2">👤</span> Profil
                        </h4>
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Nama Tampilan</label>
                                <input type="text" id="displayName" placeholder="Nama yang akan ditampilkan" class="w-full px-4 py-3 rounded-2xl glass-effect border-0 focus:ring-2 focus:ring-purple-300 focus:outline-none">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Status</label>
                                <select id="userStatus" class="w-full px-4 py-3 rounded-2xl glass-effect border-0 focus:ring-2 focus:ring-purple-300 focus:outline-none">
                                    <option value="online">🟢 Online</option>
                                    <option value="away">🟡 Away</option>
                                    <option value="busy">🔴 Busy</option>
                                    <option value="invisible">⚫ Invisible</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Bio</label>
                                <textarea id="userBio" placeholder="Ceritakan tentang dirimu..." class="w-full px-4 py-3 rounded-2xl glass-effect border-0 focus:ring-2 focus:ring-purple-300 focus:outline-none h-20 resize-none"></textarea>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Theme Settings -->
                    <div class="glass-effect rounded-2xl p-6">
                        <h4 class="text-lg font-semibold text-gray-800 mb-4 flex items-center">
                            <span class="text-2xl mr-2">🎨</span> Tema & Tampilan
                        </h4>
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-3">Pilih Tema</label>
                                <div class="grid grid-cols-3 gap-3">
                                    <button type="button" onclick="changeTheme('pastel-blue')" class="h-16 rounded-xl border-2 border-transparent hover:border-purple-300 transition-all transform hover:scale-105" style="background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);" title="Tema Biru Pastel"></button>
                                    <button type="button" onclick="changeTheme('pastel-pink')" class="h-16 rounded-xl border-2 border-transparent hover:border-purple-300 transition-all transform hover:scale-105" style="background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%);" title="Tema Pink Pastel"></button>
                                    <button type="button" onclick="changeTheme('pastel-purple')" class="h-16 rounded-xl border-2 border-transparent hover:border-purple-300 transition-all transform hover:scale-105" style="background: linear-gradient(135deg, #d299c2 0%, #fef9d7 100%);" title="Tema Ungu Pastel"></button>
                                    <button type="button" onclick="changeTheme('sunset-theme')" class="h-16 rounded-xl border-2 border-transparent hover:border-purple-300 transition-all transform hover:scale-105" style="background: linear-gradient(135deg, #ff9a9e 0%, #fad0c4 100%);" title="Tema Sunset"></button>
                                    <button type="button" onclick="changeTheme('ocean-theme')" class="h-16 rounded-xl border-2 border-transparent hover:border-purple-300 transition-all transform hover:scale-105" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);" title="Tema Ocean"></button>
                                    <button type="button" onclick="changeTheme('forest-theme')" class="h-16 rounded-xl border-2 border-transparent hover:border-purple-300 transition-all transform hover:scale-105" style="background: linear-gradient(135deg, #d4fc79 0%, #96e6a1 100%);" title="Tema Forest"></button>
                                </div>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Ukuran Font</label>
                                <select id="fontSize" class="w-full px-4 py-3 rounded-2xl glass-effect border-0 focus:ring-2 focus:ring-purple-300 focus:outline-none">
                                    <option value="small">Kecil</option>
                                    <option value="medium" selected>Sedang</option>
                                    <option value="large">Besar</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Notification & Privacy Settings -->
                <div class="space-y-6">
                    <div class="glass-effect rounded-2xl p-6">
                        <h4 class="text-lg font-semibold text-gray-800 mb-4 flex items-center">
                            <span class="text-2xl mr-2">🔔</span> Notifikasi
                        </h4>
                        <div class="space-y-4">
                            <div class="flex items-center justify-between">
                                <span class="text-gray-700">Suara Notifikasi</span>
                                <input type="checkbox" id="soundNotif" class="w-5 h-5 text-purple-600 rounded focus:ring-purple-300">
                            </div>
                            <div class="flex items-center justify-between">
                                <span class="text-gray-700">Notifikasi Desktop</span>
                                <input type="checkbox" id="desktopNotif" class="w-5 h-5 text-purple-600 rounded focus:ring-purple-300">
                            </div>
                            <div class="flex items-center justify-between">
                                <span class="text-gray-700">Preview Pesan</span>
                                <input type="checkbox" id="messagePreview" class="w-5 h-5 text-purple-600 rounded focus:ring-purple-300">
                            </div>
                        </div>
                    </div>
                    
                    <div class="glass-effect rounded-2xl p-6">
                        <h4 class="text-lg font-semibold text-gray-800 mb-4 flex items-center">
                            <span class="text-2xl mr-2">🔒</span> Privasi
                        </h4>
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Siapa yang bisa kirim pesan</label>
                                <select id="messagePrivacy" class="w-full px-4 py-3 rounded-2xl glass-effect border-0 focus:ring-2 focus:ring-purple-300 focus:outline-none">
                                    <option value="everyone">Semua orang</option>
                                    <option value="friends" selected>Hanya teman</option>
                                    <option value="nobody">Tidak ada</option>
                                </select>
                            </div>
                            <div class="flex items-center justify-between">
                                <span class="text-gray-700">Tampilkan Status Online</span>
                                <input type="checkbox" id="showOnlineStatus" class="w-5 h-5 text-purple-600 rounded focus:ring-purple-300">
                            </div>
                        </div>
                    </div>
                    
                    <!-- Meeting History -->
                    <div class="glass-effect rounded-2xl p-6">
                        <h4 class="text-lg font-semibold text-gray-800 mb-4 flex items-center">
                            <span class="text-2xl mr-2">📅</span> Meeting Terjadwal
                        </h4>
                        <div id="scheduledMeetings" class="space-y-3 max-h-48 overflow-y-auto">
                            <div class="text-center text-gray-500 py-4">
                                <div class="text-4xl mb-2">📅</div>
                                <p>Belum ada meeting terjadwal</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="flex space-x-3 mt-6 pt-4 border-t border-white/20 flex-shrink-0">
                <button onclick="resetSettings()" class="py-3 px-6 rounded-xl border border-red-300 text-red-600 hover:bg-red-50">🔄 Reset ke Default</button>
                <button onclick="closeModal('settingsModal')" class="flex-1 py-3 px-4 rounded-xl border border-gray-300 text-gray-700 hover:bg-gray-50">Batal</button>
                <button onclick="saveSettings()" class="flex-1 py-3 px-4 rounded-xl gradient-bg text-white hover:opacity-90">💾 Simpan Pengaturan</button>
            </div>
        </div>
    </div>

    <!-- Stories Modal -->
    <div id="storiesModal" class="hidden fixed inset-0 bg-black/50 flex items-center justify-center z-50">
        <div class="glass-effect rounded-3xl p-6 w-full max-w-2xl mx-4 max-h-5/6 overflow-y-auto">
            <div class="flex items-center justify-between mb-6">
                <h3 class="text-2xl font-bold text-gray-800">📸 Stories</h3>
                <button onclick="closeModal('storiesModal')" class="p-2 rounded-full hover:bg-white/20">✕</button>
            </div>
            
            <div class="text-center py-12">
                <div class="text-6xl mb-4">📸</div>
                <h3 class="text-lg font-semibold text-gray-700 mb-2">Bagikan Momen Anda</h3>
                <p class="text-gray-500 mb-6">Ceritakan hari Anda dengan foto dan teks yang akan hilang dalam 24 jam</p>
                <button onclick="createStory()" class="px-6 py-3 rounded-2xl gradient-bg text-white hover:opacity-90 transition-all transform hover:scale-105">
                    + Buat Story Pertama
                </button>
            </div>
        </div>
    </div>

    <!-- Games Modal -->
    <div id="gamesModal" class="hidden fixed inset-0 bg-black/50 flex items-center justify-center z-50">
        <div class="glass-effect rounded-3xl p-6 w-full max-w-4xl mx-4 max-h-5/6 overflow-y-auto">
            <div class="flex items-center justify-between mb-6">
                <h3 class="text-2xl font-bold text-gray-800">🎮 Mini Games</h3>
                <button onclick="closeModal('gamesModal')" class="p-2 rounded-full hover:bg-white/20">✕</button>
            </div>
            
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                <div onclick="startTicTacToe()" class="glass-effect rounded-2xl p-6 hover:bg-white/30 cursor-pointer transition-all transform hover:scale-105">
                    <div class="text-center">
                        <div class="text-4xl mb-3">⭕</div>
                        <h4 class="font-semibold text-gray-800 mb-2">Tic Tac Toe</h4>
                        <p class="text-sm text-gray-600">Main dengan teman di chat</p>
                    </div>
                </div>
                
                <div onclick="startWordGame()" class="glass-effect rounded-2xl p-6 hover:bg-white/30 cursor-pointer transition-all transform hover:scale-105">
                    <div class="text-center">
                        <div class="text-4xl mb-3">📝</div>
                        <h4 class="font-semibold text-gray-800 mb-2">Word Chain</h4>
                        <p class="text-sm text-gray-600">Sambung kata bersama</p>
                    </div>
                </div>
                
                <div onclick="startTrivia()" class="glass-effect rounded-2xl p-6 hover:bg-white/30 cursor-pointer transition-all transform hover:scale-105">
                    <div class="text-center">
                        <div class="text-4xl mb-3">🧠</div>
                        <h4 class="font-semibold text-gray-800 mb-2">Trivia Quiz</h4>
                        <p class="text-sm text-gray-600">Tes pengetahuan umum</p>
                    </div>
                </div>
                
                <div onclick="startDrawingGame()" class="glass-effect rounded-2xl p-6 hover:bg-white/30 cursor-pointer transition-all transform hover:scale-105">
                    <div class="text-center">
                        <div class="text-4xl mb-3">🎨</div>
                        <h4 class="font-semibold text-gray-800 mb-2">Guess Drawing</h4>
                        <p class="text-sm text-gray-600">Gambar dan tebak</p>
                    </div>
                </div>
                
                <div onclick="startRockPaperScissors()" class="glass-effect rounded-2xl p-6 hover:bg-white/30 cursor-pointer transition-all transform hover:scale-105">
                    <div class="text-center">
                        <div class="text-4xl mb-3">✂️</div>
                        <h4 class="font-semibold text-gray-800 mb-2">Gunting Batu Kertas</h4>
                        <p class="text-sm text-gray-600">Klasik yang tak lekang waktu</p>
                    </div>
                </div>
                
                <div onclick="startMemoryGame()" class="glass-effect rounded-2xl p-6 hover:bg-white/30 cursor-pointer transition-all transform hover:scale-105">
                    <div class="text-center">
                        <div class="text-4xl mb-3">🧩</div>
                        <h4 class="font-semibold text-gray-800 mb-2">Memory Match</h4>
                        <p class="text-sm text-gray-600">Uji daya ingat</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Music Player Modal -->
    <div id="musicModal" class="hidden fixed inset-0 bg-black/50 flex items-center justify-center z-50">
        <div class="glass-effect rounded-3xl p-6 w-full max-w-2xl mx-4 max-h-5/6 overflow-y-auto">
            <div class="flex items-center justify-between mb-6">
                <h3 class="text-2xl font-bold text-gray-800">🎵 Music Player</h3>
                <button onclick="closeModal('musicModal')" class="p-2 rounded-full hover:bg-white/20">✕</button>
            </div>
            
            <!-- Current Playing -->
            <div class="glass-effect rounded-2xl p-6 mb-6">
                <div class="text-center">
                    <div class="w-32 h-32 mx-auto rounded-2xl gradient-bg flex items-center justify-center text-6xl mb-4">🎵</div>
                    <h4 id="currentSong" class="text-xl font-bold text-gray-800 mb-2">Lofi Study Beats</h4>
                    <p id="currentArtist" class="text-gray-600 mb-4">ChitChat Radio</p>
                    
                    <!-- Progress Bar -->
                    <div class="w-full bg-white/30 rounded-full h-2 mb-4">
                        <div id="progressBar" class="gradient-bg h-2 rounded-full" style="width: 45%"></div>
                    </div>
                    
                    <!-- Controls -->
                    <div class="flex items-center justify-center space-x-4">
                        <button onclick="previousSong()" class="p-3 rounded-full glass-effect hover:bg-white/30 transition-all">
                            <span class="text-2xl">⏮️</span>
                        </button>
                        <button onclick="togglePlay()" id="playBtn" class="p-4 rounded-full gradient-bg text-white hover:opacity-90 transition-all transform hover:scale-105">
                            <span class="text-3xl">⏸️</span>
                        </button>
                        <button onclick="nextSong()" class="p-3 rounded-full glass-effect hover:bg-white/30 transition-all">
                            <span class="text-2xl">⏭️</span>
                        </button>
                    </div>
                    
                    <!-- Volume -->
                    <div class="flex items-center space-x-3 mt-4">
                        <span class="text-xl">🔊</span>
                        <input type="range" id="volumeSlider" min="0" max="100" value="70" class="flex-1 h-2 bg-white/30 rounded-lg appearance-none slider">
                        <span class="text-sm text-gray-600">70%</span>
                    </div>
                </div>
            </div>
            
            <!-- Playlist -->
            <div class="glass-effect rounded-2xl p-4">
                <h4 class="text-lg font-semibold text-gray-800 mb-4">🎶 Playlist</h4>
                <div class="space-y-2 max-h-64 overflow-y-auto">
                    <div onclick="playSong('Lofi Study Beats', 'ChitChat Radio')" class="flex items-center space-x-3 p-3 rounded-xl hover:bg-white/20 cursor-pointer transition-all bg-white/10">
                        <span class="text-2xl">🎵</span>
                        <div class="flex-1">
                            <p class="font-medium text-gray-800">Lofi Study Beats</p>
                            <p class="text-sm text-gray-600">ChitChat Radio</p>
                        </div>
                        <span class="text-sm text-gray-500">3:45</span>
                    </div>
                    <div onclick="playSong('Chill Vibes', 'Ambient Sounds')" class="flex items-center space-x-3 p-3 rounded-xl hover:bg-white/20 cursor-pointer transition-all">
                        <span class="text-2xl">🌊</span>
                        <div class="flex-1">
                            <p class="font-medium text-gray-800">Chill Vibes</p>
                            <p class="text-sm text-gray-600">Ambient Sounds</p>
                        </div>
                        <span class="text-sm text-gray-500">4:12</span>
                    </div>
                    <div onclick="playSong('Focus Flow', 'Productivity Mix')" class="flex items-center space-x-3 p-3 rounded-xl hover:bg-white/20 cursor-pointer transition-all">
                        <span class="text-2xl">🧠</span>
                        <div class="flex-1">
                            <p class="font-medium text-gray-800">Focus Flow</p>
                            <p class="text-sm text-gray-600">Productivity Mix</p>
                        </div>
                        <span class="text-sm text-gray-500">5:23</span>
                    </div>
                    <div onclick="playSong('Nature Sounds', 'Relaxation')" class="flex items-center space-x-3 p-3 rounded-xl hover:bg-white/20 cursor-pointer transition-all">
                        <span class="text-2xl">🌿</span>
                        <div class="flex-1">
                            <p class="font-medium text-gray-800">Nature Sounds</p>
                            <p class="text-sm text-gray-600">Relaxation</p>
                        </div>
                        <span class="text-sm text-gray-500">6:18</span>
                    </div>
                    <div onclick="playSong('Coffee Shop Jazz', 'Smooth Jazz')" class="flex items-center space-x-3 p-3 rounded-xl hover:bg-white/20 cursor-pointer transition-all">
                        <span class="text-2xl">☕</span>
                        <div class="flex-1">
                            <p class="font-medium text-gray-800">Coffee Shop Jazz</p>
                            <p class="text-sm text-gray-600">Smooth Jazz</p>
                        </div>
                        <span class="text-sm text-gray-500">4:56</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- AI Assistant Modal -->
    <div id="aiModal" class="hidden fixed inset-0 bg-black/50 flex items-center justify-center z-50">
        <div class="glass-effect rounded-3xl p-6 w-full max-w-4xl mx-4 h-5/6 flex flex-col">
            <div class="flex items-center justify-between mb-6 flex-shrink-0">
                <h3 class="text-2xl font-bold text-gray-800">🤖 AI Assistant - Chatty</h3>
                <button onclick="closeModal('aiModal')" class="p-2 rounded-full hover:bg-white/20">✕</button>
            </div>
            
            <div class="flex flex-1 gap-6 overflow-hidden">
                <!-- AI Chat -->
                <div class="flex-1 flex flex-col">
                    <div class="glass-effect rounded-2xl p-4 mb-4 flex-shrink-0">
                        <div class="flex items-center space-x-3">
                            <div class="w-12 h-12 rounded-full gradient-bg flex items-center justify-center text-2xl">🤖</div>
                            <div>
                                <h4 class="font-semibold text-gray-800">Chatty AI</h4>
                                <p class="text-sm text-gray-600">Siap membantu Anda!</p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- AI Chat Messages -->
                    <div id="aiChatMessages" class="flex-1 overflow-y-auto space-y-4 mb-4">
                        <div class="flex items-start space-x-3">
                            <div class="w-8 h-8 rounded-full gradient-bg flex items-center justify-center text-white text-sm">🤖</div>
                            <div class="glass-effect rounded-2xl p-4 max-w-md">
                                <p class="text-gray-800">Halo! Saya Chatty, asisten AI Anda. Saya bisa membantu dengan:</p>
                                <ul class="mt-2 text-sm text-gray-700 space-y-1">
                                    <li>• Menjawab pertanyaan</li>
                                    <li>• Memberikan saran</li>
                                    <li>• Membantu brainstorming</li>
                                    <li>• Menerjemahkan bahasa</li>
                                    <li>• Dan masih banyak lagi!</li>
                                </ul>
                                <p class="mt-2 text-sm text-gray-600">Apa yang bisa saya bantu hari ini? 😊</p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- AI Input -->
                    <div class="flex items-center space-x-3 flex-shrink-0">
                        <input type="text" id="aiInput" placeholder="Tanya Chatty apa saja..." class="flex-1 px-4 py-3 rounded-2xl glass-effect border-0 focus:ring-2 focus:ring-purple-300 focus:outline-none" onkeypress="handleAIEnter(event)">
                        <button onclick="sendAIMessage()" class="p-3 rounded-full gradient-bg text-white hover:opacity-90 transition-all transform hover:scale-105">
                            <span class="text-xl">🚀</span>
                        </button>
                    </div>
                </div>
                
                <!-- AI Features -->
                <div class="w-80 space-y-4">
                    <div class="glass-effect rounded-2xl p-4">
                        <h4 class="font-semibold text-gray-800 mb-3">🎯 Quick Actions</h4>
                        <div class="space-y-2">
                            <button onclick="askAI('Berikan tips produktivitas untuk hari ini')" class="w-full text-left p-2 rounded-xl hover:bg-white/20 transition-all text-sm">
                                💡 Tips Produktivitas
                            </button>
                            <button onclick="askAI('Ceritakan joke lucu untuk menghibur')" class="w-full text-left p-2 rounded-xl hover:bg-white/20 transition-all text-sm">
                                😂 Cerita Joke
                            </button>
                            <button onclick="askAI('Berikan motivasi untuk semangat kerja')" class="w-full text-left p-2 rounded-xl hover:bg-white/20 transition-all text-sm">
                                🔥 Motivasi Harian
                            </button>
                            <button onclick="askAI('Sarankan aktivitas menarik untuk weekend')" class="w-full text-left p-2 rounded-xl hover:bg-white/20 transition-all text-sm">
                                🎉 Ide Weekend
                            </button>
                        </div>
                    </div>
                    
                    <div class="glass-effect rounded-2xl p-4">
                        <h4 class="font-semibold text-gray-800 mb-3">🌍 Translator</h4>
                        <div class="space-y-3">
                            <select id="translateFrom" class="w-full px-3 py-2 rounded-xl glass-effect border-0 text-sm">
                                <option value="id">Indonesia</option>
                                <option value="en">English</option>
                                <option value="ja">Japanese</option>
                                <option value="ko">Korean</option>
                            </select>
                            <select id="translateTo" class="w-full px-3 py-2 rounded-xl glass-effect border-0 text-sm">
                                <option value="en">English</option>
                                <option value="id">Indonesia</option>
                                <option value="ja">Japanese</option>
                                <option value="ko">Korean</option>
                            </select>
                            <textarea id="translateText" placeholder="Masukkan teks..." class="w-full px-3 py-2 rounded-xl glass-effect border-0 text-sm h-20 resize-none"></textarea>
                            <button onclick="translateText()" class="w-full py-2 rounded-xl gradient-bg text-white text-sm hover:opacity-90">
                                🌍 Terjemahkan
                            </button>
                        </div>
                    </div>
                    
                    <div class="glass-effect rounded-2xl p-4">
                        <h4 class="font-semibold text-gray-800 mb-3">📊 AI Stats</h4>
                        <div class="space-y-2 text-sm">
                            <div class="flex justify-between">
                                <span class="text-gray-600">Pertanyaan hari ini:</span>
                                <span class="font-medium">12</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-600">Terjemahan:</span>
                                <span class="font-medium">5</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-600">Tips diberikan:</span>
                                <span class="font-medium">8</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Invite Friends to Room Modal -->
    <div id="inviteRoomModal" class="hidden fixed inset-0 bg-black/50 flex items-center justify-center z-50">
        <div class="glass-effect rounded-3xl p-6 w-full max-w-md mx-4">
            <div class="flex items-center justify-between mb-6">
                <h3 class="text-xl font-bold text-gray-800">👥 Undang Teman ke Room</h3>
                <button onclick="closeModal('inviteRoomModal')" class="p-2 rounded-full hover:bg-white/20">✕</button>
            </div>
            
            <div class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Room: <span id="inviteRoomName" class="font-semibold text-purple-600">General Chat</span></label>
                    <div class="glass-effect rounded-xl p-3 text-sm text-gray-600">
                        <div class="flex items-center justify-between">
                            <span>Link Room:</span>
                            <button onclick="copyRoomLink()" class="text-purple-600 hover:text-purple-800 text-xs">📋 Copy</button>
                        </div>
                        <div id="roomLink" class="text-xs text-gray-500 mt-1 break-all">https://chitchat.com/room/general-abc123</div>
                    </div>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Email Teman</label>
                    <div class="flex space-x-2 mb-2">
                        <input type="email" id="inviteEmail" placeholder="Email teman" class="flex-1 px-4 py-2 rounded-xl glass-effect border-0 focus:ring-2 focus:ring-purple-300 focus:outline-none">
                        <button onclick="addInviteEmail()" class="px-4 py-2 rounded-xl gradient-bg text-white hover:opacity-90">Tambah</button>
                    </div>
                    <div id="inviteEmailsList" class="space-y-2 max-h-32 overflow-y-auto"></div>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Pesan Undangan (Opsional)</label>
                    <textarea id="inviteMessage" placeholder="Ayo join room ini! Kita bisa ngobrol dan video call bareng..." class="w-full px-4 py-3 rounded-2xl glass-effect border-0 focus:ring-2 focus:ring-purple-300 focus:outline-none h-20 resize-none"></textarea>
                </div>
            </div>
            
            <div class="flex space-x-3 mt-6">
                <button onclick="closeModal('inviteRoomModal')" class="flex-1 py-2 px-4 rounded-xl border border-gray-300 text-gray-700 hover:bg-gray-50">Batal</button>
                <button onclick="sendRoomInvitations()" class="flex-1 py-2 px-4 rounded-xl gradient-bg text-white hover:opacity-90">📧 Kirim Undangan</button>
            </div>
        </div>
    </div>

    <!-- Poll Creation Modal -->
    <div id="pollModal" class="hidden fixed inset-0 bg-black/50 flex items-center justify-center z-50">
        <div class="glass-effect rounded-3xl p-6 w-full max-w-md mx-4">
            <div class="flex items-center justify-between mb-6">
                <h3 class="text-xl font-bold text-gray-800">📊 Buat Polling</h3>
                <button onclick="closeModal('pollModal')" class="p-2 rounded-full hover:bg-white/20">✕</button>
            </div>
            
            <div class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Pertanyaan</label>
                    <input type="text" id="pollQuestion" placeholder="Apa pertanyaan Anda?" class="w-full px-4 py-3 rounded-2xl glass-effect border-0 focus:ring-2 focus:ring-purple-300 focus:outline-none">
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Pilihan Jawaban</label>
                    <div id="pollOptions" class="space-y-2">
                        <input type="text" placeholder="Pilihan 1" class="w-full px-4 py-2 rounded-xl glass-effect border-0 focus:ring-2 focus:ring-purple-300 focus:outline-none">
                        <input type="text" placeholder="Pilihan 2" class="w-full px-4 py-2 rounded-xl glass-effect border-0 focus:ring-2 focus:ring-purple-300 focus:outline-none">
                    </div>
                    <button onclick="addPollOption()" class="mt-2 text-sm text-purple-600 hover:text-purple-800">+ Tambah Pilihan</button>
                </div>
                
                <div class="flex items-center space-x-2">
                    <input type="checkbox" id="allowMultiple" class="w-4 h-4 text-purple-600 rounded">
                    <label class="text-sm text-gray-700">Izinkan pilihan ganda</label>
                </div>
            </div>
            
            <div class="flex space-x-3 mt-6">
                <button onclick="closeModal('pollModal')" class="flex-1 py-2 px-4 rounded-xl border border-gray-300 text-gray-700 hover:bg-gray-50">Batal</button>
                <button onclick="createPollMessage()" class="flex-1 py-2 px-4 rounded-xl gradient-bg text-white hover:opacity-90">Buat Poll</button>
            </div>
        </div>
    </div>

    <script>
        let currentUser = '';
        let currentRoom = 'general';
        let cameraOn = false;
        let micOn = false;
        let easterEggCount = 0;
        let scheduledMeetings = [];
        let participants = [];
        let inviteEmails = [];
        let typingTimer;
        let currentLogoIndex = 1;
        let isPlaying = true;
        let currentSongIndex = 0;
        let aiQuestionCount = 12;
        let translationCount = 5;
        let tipsCount = 8;
        
        const playlist = [
            { title: 'Lofi Study Beats', artist: 'ChitChat Radio', duration: '3:45', emoji: '🎵' },
            { title: 'Chill Vibes', artist: 'Ambient Sounds', duration: '4:12', emoji: '🌊' },
            { title: 'Focus Flow', artist: 'Productivity Mix', duration: '5:23', emoji: '🧠' },
            { title: 'Nature Sounds', artist: 'Relaxation', duration: '6:18', emoji: '🌿' },
            { title: 'Coffee Shop Jazz', artist: 'Smooth Jazz', duration: '4:56', emoji: '☕' }
        ];
        
        // User settings with defaults
        let userSettings = {
            displayName: '',
            status: 'online',
            bio: '',
            theme: 'pastel-blue',
            fontSize: 'medium',
            soundNotif: true,
            desktopNotif: true,
            messagePreview: true,
            messagePrivacy: 'friends',
            showOnlineStatus: true
        };

        function login() {
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;
            
            if (email && password) {
                currentUser = email;
                userSettings.displayName = email.split('@')[0];
                document.getElementById('userEmail').textContent = email;
                document.getElementById('userDisplayName').textContent = userSettings.displayName;
                document.getElementById('loginPage').classList.add('hidden');
                document.getElementById('mainApp').classList.remove('hidden');
                
                // Set default meeting date to today
                const today = new Date().toISOString().split('T')[0];
                document.getElementById('meetingDate').value = today;
                
                // Easter egg untuk login
                createEasterEgg('🎉', Math.random() * window.innerWidth, Math.random() * window.innerHeight);
            } else {
                alert('Mohon isi email dan password!');
            }
        }

        function showRegister() {
            document.getElementById('loginPage').classList.add('hidden');
            document.getElementById('registerPage').classList.remove('hidden');
            createEasterEgg('📝', Math.random() * window.innerWidth, Math.random() * window.innerHeight);
        }

        function showLogin() {
            document.getElementById('registerPage').classList.add('hidden');
            document.getElementById('forgotPasswordPage').classList.add('hidden');
            document.getElementById('loginPage').classList.remove('hidden');
            createEasterEgg('🔑', Math.random() * window.innerWidth, Math.random() * window.innerHeight);
        }

        function showForgotPassword() {
            document.getElementById('loginPage').classList.add('hidden');
            document.getElementById('forgotPasswordPage').classList.remove('hidden');
            createEasterEgg('🔑', Math.random() * window.innerWidth, Math.random() * window.innerHeight);
        }

        function register() {
            const name = document.getElementById('registerName').value;
            const email = document.getElementById('registerEmail').value;
            const password = document.getElementById('registerPassword').value;
            const confirmPassword = document.getElementById('confirmPassword').value;
            const agreeTerms = document.getElementById('agreeTerms').checked;
            
            if (!name || !email || !password || !confirmPassword) {
                alert('Mohon isi semua field yang diperlukan!');
                return;
            }
            
            if (password !== confirmPassword) {
                alert('Password dan konfirmasi password tidak sama!');
                return;
            }
            
            if (!agreeTerms) {
                alert('Mohon setujui syarat dan ketentuan terlebih dahulu!');
                return;
            }
            
            // Simulate successful registration
            alert(`Selamat datang ${name}! Akun Anda berhasil dibuat! 🎉`);
            
            // Auto login after registration
            currentUser = email;
            userSettings.displayName = name;
            document.getElementById('userEmail').textContent = email;
            document.getElementById('userDisplayName').textContent = name;
            
            // Clear registration form
            document.getElementById('registerName').value = '';
            document.getElementById('registerEmail').value = '';
            document.getElementById('registerPassword').value = '';
            document.getElementById('confirmPassword').value = '';
            document.getElementById('agreeTerms').checked = false;
            
            // Go to main app
            document.getElementById('registerPage').classList.add('hidden');
            document.getElementById('mainApp').classList.remove('hidden');
            
            // Set default meeting date to today
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('meetingDate').value = today;
            
            // Easter egg untuk registrasi berhasil
            createEasterEgg('🎉', Math.random() * window.innerWidth, Math.random() * window.innerHeight);
            createEasterEgg('✨', Math.random() * window.innerWidth, Math.random() * window.innerHeight);
        }

        function sendResetLink() {
            const email = document.getElementById('forgotEmail').value;
            
            if (!email) {
                alert('Mohon masukkan email Anda!');
                return;
            }
            
            alert(`Link reset password telah dikirim ke ${email}! Silakan cek email Anda. 📧✨`);
            document.getElementById('forgotEmail').value = '';
            createEasterEgg('📧', Math.random() * window.innerWidth, Math.random() * window.innerHeight);
        }

        function logout() {
            document.getElementById('loginPage').classList.remove('hidden');
            document.getElementById('mainApp').classList.add('hidden');
            document.getElementById('loginEmail').value = '';
            document.getElementById('loginPassword').value = '';
        }

        function showTab(tab) {
            // Reset tab buttons
            document.getElementById('roomsTab').className = 'flex-1 py-2 px-4 rounded-xl hover:bg-white/20 text-gray-600 font-medium transition-all';
            document.getElementById('friendsTab').className = 'flex-1 py-2 px-4 rounded-xl hover:bg-white/20 text-gray-600 font-medium transition-all';
            
            // Hide all content
            document.getElementById('roomsContent').classList.add('hidden');
            document.getElementById('friendsContent').classList.add('hidden');
            
            // Show selected tab
            if (tab === 'rooms') {
                document.getElementById('roomsTab').className = 'flex-1 py-2 px-4 rounded-xl bg-white/30 text-gray-700 font-medium transition-all';
                document.getElementById('roomsContent').classList.remove('hidden');
            } else {
                document.getElementById('friendsTab').className = 'flex-1 py-2 px-4 rounded-xl bg-white/30 text-gray-700 font-medium transition-all';
                document.getElementById('friendsContent').classList.remove('hidden');
            }
        }

        function joinRoom(roomName) {
            currentRoom = roomName;
            const titles = {
                'general': 'General Chat',
                'study': 'Study Group',
                'gaming': 'Gaming Zone'
            };
            document.getElementById('roomTitle').textContent = titles[roomName] || roomName;
            
            // Add some sparkle effect
            createEasterEgg('✨', Math.random() * window.innerWidth, Math.random() * window.innerHeight);
        }

        function toggleCamera() {
            cameraOn = !cameraOn;
            const btn = document.getElementById('cameraBtn');
            const videoArea = document.getElementById('videoArea');
            
            if (cameraOn) {
                btn.classList.add('bg-green-400');
                videoArea.classList.remove('hidden');
                createEasterEgg('📹', Math.random() * window.innerWidth, Math.random() * window.innerHeight);
            } else {
                btn.classList.remove('bg-green-400');
                videoArea.classList.add('hidden');
            }
        }

        function toggleMic() {
            micOn = !micOn;
            const btn = document.getElementById('micBtn');
            
            if (micOn) {
                btn.classList.add('bg-green-400');
                createEasterEgg('🎤', Math.random() * window.innerWidth, Math.random() * window.innerHeight);
            } else {
                btn.classList.remove('bg-green-400');
            }
        }

        function shareScreen() {
            alert('Fitur share screen akan segera tersedia! 🖥️✨');
            createEasterEgg('🖥️', Math.random() * window.innerWidth, Math.random() * window.innerHeight);
        }

        function openWhiteboard() {
            document.getElementById('whiteboardModal').classList.remove('hidden');
        }

        function uploadFile() {
            document.getElementById('fileUploadModal').classList.remove('hidden');
        }

        function addFriend() {
            document.getElementById('addFriendModal').classList.remove('hidden');
        }

        function createRoom() {
            document.getElementById('createRoomModal').classList.remove('hidden');
        }

        function closeModal(modalId) {
            document.getElementById(modalId).classList.add('hidden');
        }

        function sendFriendRequest() {
            const email = document.getElementById('friendEmail').value;
            if (email) {
                alert(`Undangan teman telah dikirim ke ${email}! 💌`);
                closeModal('addFriendModal');
                document.getElementById('friendEmail').value = '';
                createEasterEgg('💌', Math.random() * window.innerWidth, Math.random() * window.innerHeight);
            }
        }

        function createNewRoom() {
            const name = document.getElementById('roomName').value;
            if (name) {
                alert(`Room "${name}" berhasil dibuat! 🎉`);
                closeModal('createRoomModal');
                document.getElementById('roomName').value = '';
                document.getElementById('roomDescription').value = '';
                createEasterEgg('🎉', Math.random() * window.innerWidth, Math.random() * window.innerHeight);
            }
        }

        function uploadSelectedFile() {
            const fileInput = document.getElementById('fileInput');
            if (fileInput.files.length > 0) {
                alert(`${fileInput.files.length} file berhasil diupload! 📎✨`);
                closeModal('fileUploadModal');
                createEasterEgg('📎', Math.random() * window.innerWidth, Math.random() * window.innerHeight);
            }
        }

        function startVideoCall(friendName) {
            alert(`Memulai video call dengan ${friendName}... 📹💕`);
            toggleCamera();
            createEasterEgg('💕', Math.random() * window.innerWidth, Math.random() * window.innerHeight);
        }

        function addEmoji() {
            // Create emoji picker modal
            const emojiModal = document.createElement('div');
            emojiModal.id = 'emojiPicker';
            emojiModal.className = 'fixed inset-0 bg-black/50 flex items-center justify-center z-50';
            
            const emojiCategories = {
                'Senyum': ['😊', '😂', '🤣', '😍', '🥰', '😘', '😋', '😎', '🤗', '🙂', '😉', '😇'],
                'Hati': ['❤️', '💕', '💖', '💗', '💙', '💚', '💛', '🧡', '💜', '🖤', '🤍', '🤎'],
                'Tangan': ['👍', '👎', '👌', '✌️', '🤞', '🤟', '🤘', '👏', '🙌', '👐', '🤲', '🙏'],
                'Aktivitas': ['🎉', '🎊', '🎈', '🎁', '🎂', '🎵', '🎶', '🎤', '🎧', '🎮', '🏆', '⚽'],
                'Objek': ['✨', '🔥', '💯', '🚀', '🌟', '⭐', '💎', '🎯', '📱', '💻', '📚', '✏️'],
                'Makanan': ['🍕', '🍔', '🍟', '🌭', '🍿', '🧋', '☕', '🍰', '🍪', '🍎', '🍌', '🍓']
            };
            
            let categoriesHTML = '';
            for (const [category, emojis] of Object.entries(emojiCategories)) {
                const emojiButtons = emojis.map(emoji => 
                    `<button onclick="selectEmoji('${emoji}')" class="w-10 h-10 rounded-lg hover:bg-white/20 transition-all text-2xl">${emoji}</button>`
                ).join('');
                
                categoriesHTML += `
                    <div class="mb-4">
                        <h4 class="text-sm font-medium text-gray-700 mb-2">${category}</h4>
                        <div class="grid grid-cols-6 gap-2">
                            ${emojiButtons}
                        </div>
                    </div>
                `;
            }
            
            emojiModal.innerHTML = `
                <div class="glass-effect rounded-3xl p-6 w-full max-w-md mx-4 max-h-96 overflow-y-auto">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="text-xl font-bold text-gray-800">😊 Pilih Emoji</h3>
                        <button onclick="closeEmojiPicker()" class="p-2 rounded-full hover:bg-white/20">✕</button>
                    </div>
                    <div class="space-y-4">
                        ${categoriesHTML}
                    </div>
                </div>
            `;
            
            document.body.appendChild(emojiModal);
        }
        
        function selectEmoji(emoji) {
            const input = document.getElementById('messageInput');
            input.value += emoji;
            input.focus();
            closeEmojiPicker();
            createEasterEgg(emoji, Math.random() * window.innerWidth, Math.random() * window.innerHeight);
        }
        
        function closeEmojiPicker() {
            const emojiPicker = document.getElementById('emojiPicker');
            if (emojiPicker) {
                emojiPicker.remove();
            }
        }

        function sendMessage() {
            const input = document.getElementById('messageInput');
            const message = input.value.trim();
            
            if (message) {
                const chatMessages = document.getElementById('chatMessages');
                
                // Remove empty state if it exists
                const emptyState = chatMessages.querySelector('.text-center.py-12');
                if (emptyState) {
                    emptyState.remove();
                }
                
                const messageDiv = document.createElement('div');
                messageDiv.className = 'chat-bubble group';
                messageDiv.innerHTML = `
                    <div class="flex items-start space-x-3 flex-row-reverse">
                        <div class="w-8 h-8 rounded-full bg-purple-400 flex-shrink-0"></div>
                        <div class="text-right">
                            <div class="flex items-center space-x-2 mb-1 justify-end">
                                <span class="text-xs text-gray-500">${new Date().toLocaleTimeString('id-ID', {hour: '2-digit', minute: '2-digit'})}</span>
                                <span class="font-medium text-gray-800">${userSettings.displayName}</span>
                            </div>
                            <div class="bg-gradient-to-r from-purple-400 to-pink-400 text-white rounded-2xl rounded-tr-md p-3 max-w-md relative">
                                <p>${message}</p>
                                <div class="hidden group-hover:flex absolute -left-16 top-1/2 transform -translate-y-1/2 space-x-1">
                                    <button onclick="addReaction(this, '❤️')" class="w-6 h-6 rounded-full bg-white/20 hover:bg-white/30 flex items-center justify-center text-xs">❤️</button>
                                    <button onclick="addReaction(this, '😂')" class="w-6 h-6 rounded-full bg-white/20 hover:bg-white/30 flex items-center justify-center text-xs">😂</button>
                                    <button onclick="addReaction(this, '👍')" class="w-6 h-6 rounded-full bg-white/20 hover:bg-white/30 flex items-center justify-center text-xs">👍</button>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
                
                chatMessages.appendChild(messageDiv);
                chatMessages.scrollTop = chatMessages.scrollHeight;
                input.value = '';
                
                // Hide typing indicator
                document.getElementById('typingIndicator').classList.add('hidden');
            }
        }
        
        function addReaction(button, emoji) {
            const messageDiv = button.closest('.chat-bubble');
            let reactionDiv = messageDiv.querySelector('.reactions');
            
            if (!reactionDiv) {
                reactionDiv = document.createElement('div');
                reactionDiv.className = 'reactions flex space-x-1 mt-2 justify-end';
                messageDiv.appendChild(reactionDiv);
            }
            
            const reactionButton = document.createElement('button');
            reactionButton.className = 'px-2 py-1 rounded-full bg-white/20 text-xs hover:bg-white/30 transition-all';
            reactionButton.textContent = emoji + ' 1';
            reactionDiv.appendChild(reactionButton);
            
            createEasterEgg(emoji, Math.random() * window.innerWidth, Math.random() * window.innerHeight);
        }
        
        function showTypingIndicator() {
            document.getElementById('typingIndicator').classList.remove('hidden');
            
            clearTimeout(typingTimer);
            typingTimer = setTimeout(() => {
                document.getElementById('typingIndicator').classList.add('hidden');
            }, 2000);
        }

        function handleEnter(event) {
            if (event.key === 'Enter') {
                sendMessage();
            }
        }

        // Easter Egg Functions
        function createEasterEgg(emoji, x, y) {
            const easterEgg = document.createElement('div');
            easterEgg.className = 'easter-egg';
            easterEgg.textContent = emoji;
            easterEgg.style.left = x + 'px';
            easterEgg.style.top = y + 'px';
            document.body.appendChild(easterEgg);
            
            setTimeout(() => {
                easterEgg.remove();
            }, 2000);
        }

        function toggleEasterEgg() {
            easterEggCount++;
            const emojis = ['🎨', '🌈', '✨', '🦄', '🎭', '🎪', '🎨', '🌟'];
            
            for (let i = 0; i < 5; i++) {
                setTimeout(() => {
                    createEasterEgg(
                        emojis[Math.floor(Math.random() * emojis.length)],
                        Math.random() * window.innerWidth,
                        Math.random() * window.innerHeight
                    );
                }, i * 200);
            }
            
            if (easterEggCount === 5) {
                setTimeout(() => {
                    alert('🎉 Selamat! Kamu menemukan easter egg! Kamu adalah ChitChat Explorer! 🌟');
                }, 1000);
            }
        }







        // Meeting Scheduler Functions
        function openMeetingScheduler() {
            document.getElementById('meetingModal').classList.remove('hidden');
            // Set default date to today
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('meetingDate').value = today;
        }
        
        function addParticipant() {
            const email = document.getElementById('participantEmail').value.trim();
            if (email && !participants.includes(email)) {
                participants.push(email);
                updateParticipantsList();
                document.getElementById('participantEmail').value = '';
            }
        }
        
        function updateParticipantsList() {
            const list = document.getElementById('participantsList');
            list.innerHTML = '';
            
            participants.forEach((email, index) => {
                const participantDiv = document.createElement('div');
                participantDiv.className = 'flex items-center justify-between glass-effect rounded-xl p-2';
                participantDiv.innerHTML = `
                    <span class="text-sm text-gray-700">${email}</span>
                    <button onclick="removeParticipant(${index})" class="text-red-500 hover:text-red-700 text-sm">✕</button>
                `;
                list.appendChild(participantDiv);
            });
        }
        
        function removeParticipant(index) {
            participants.splice(index, 1);
            updateParticipantsList();
        }
        
        function scheduleMeeting() {
            const title = document.getElementById('meetingTitle').value;
            const type = document.getElementById('meetingType').value;
            const date = document.getElementById('meetingDate').value;
            const time = document.getElementById('meetingTime').value;
            const duration = document.getElementById('meetingDuration').value;
            const description = document.getElementById('meetingDescription').value;
            const reminder = document.getElementById('meetingReminder').value;
            const location = document.getElementById('meetingLocation').value;
            
            if (!title || !date || !time) {
                alert('Mohon isi judul, tanggal, dan waktu meeting!');
                return;
            }
            
            const meeting = {
                id: Date.now(),
                title,
                type,
                date,
                time,
                duration,
                description,
                participants: [...participants],
                reminder,
                location,
                created: new Date().toISOString()
            };
            
            scheduledMeetings.push(meeting);
            updateScheduledMeetingsList();
            
            // Clear form
            document.getElementById('meetingTitle').value = '';
            document.getElementById('meetingDescription').value = '';
            document.getElementById('meetingLocation').value = '';
            participants = [];
            updateParticipantsList();
            
            closeModal('meetingModal');
            
            // Send meeting notification to chat
            sendMeetingNotification(meeting);
            
            alert(`Meeting "${title}" berhasil dijadwalkan untuk ${formatDate(date)} pukul ${time}! 📅✨`);
            createEasterEgg('📅', Math.random() * window.innerWidth, Math.random() * window.innerHeight);
        }
        
        function sendMeetingNotification(meeting) {
            const chatMessages = document.getElementById('chatMessages');
            
            // Remove empty state if it exists
            const emptyState = chatMessages.querySelector('.text-center.py-12');
            if (emptyState) {
                emptyState.remove();
            }
            
            const messageDiv = document.createElement('div');
            messageDiv.className = 'chat-bubble';
            messageDiv.innerHTML = `
                <div class="flex items-start space-x-3">
                    <div class="w-8 h-8 rounded-full bg-blue-400 flex items-center justify-center text-white text-sm">📅</div>
                    <div class="flex-1">
                        <div class="glass-effect rounded-2xl p-4 max-w-md">
                            <div class="flex items-center space-x-2 mb-2">
                                <span class="text-lg">📅</span>
                                <span class="font-semibold text-gray-800">Meeting Dijadwalkan</span>
                            </div>
                            <div class="space-y-2 text-sm">
                                <div><strong>Judul:</strong> ${meeting.title}</div>
                                <div><strong>Tanggal:</strong> ${formatDate(meeting.date)}</div>
                                <div><strong>Waktu:</strong> ${meeting.time}</div>
                                <div><strong>Durasi:</strong> ${meeting.duration} menit</div>
                                ${meeting.location ? `<div><strong>Lokasi:</strong> ${meeting.location}</div>` : ''}
                                ${meeting.description ? `<div><strong>Deskripsi:</strong> ${meeting.description}</div>` : ''}
                            </div>
                            <button onclick="joinMeetingFromChat('${meeting.id}')" class="mt-3 w-full py-2 rounded-xl gradient-bg text-white text-sm hover:opacity-90">
                                🚀 Join Meeting
                            </button>
                        </div>
                    </div>
                </div>
            `;
            
            chatMessages.appendChild(messageDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }
        
        function joinMeetingFromChat(meetingId) {
            const meeting = scheduledMeetings.find(m => m.id == meetingId);
            if (meeting) {
                alert(`Bergabung ke meeting "${meeting.title}"... 🚀`);
                if (meeting.type === 'video') {
                    toggleCamera();
                }
                createEasterEgg('🚀', Math.random() * window.innerWidth, Math.random() * window.innerHeight);
            }
        }
        
        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('id-ID', { 
                weekday: 'long', 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric' 
            });
        }
        
        function updateScheduledMeetingsList() {
            const list = document.getElementById('scheduledMeetings');
            
            if (scheduledMeetings.length === 0) {
                list.innerHTML = `
                    <div class="text-center text-gray-500 py-4">
                        <div class="text-4xl mb-2">📅</div>
                        <p>Belum ada meeting terjadwal</p>
                    </div>
                `;
                return;
            }
            
            list.innerHTML = '';
            scheduledMeetings.forEach(meeting => {
                const meetingDiv = document.createElement('div');
                meetingDiv.className = 'glass-effect rounded-xl p-3';
                meetingDiv.innerHTML = `
                    <div class="flex items-center justify-between">
                        <div>
                            <h5 class="font-medium text-gray-800">${meeting.title}</h5>
                            <p class="text-xs text-gray-600">${formatDate(meeting.date)} • ${meeting.time}</p>
                        </div>
                        <button onclick="deleteMeeting(${meeting.id})" class="text-red-500 hover:text-red-700 text-sm">🗑️</button>
                    </div>
                `;
                list.appendChild(meetingDiv);
            });
        }
        
        function deleteMeeting(meetingId) {
            if (confirm('Yakin ingin hapus meeting ini?')) {
                scheduledMeetings = scheduledMeetings.filter(m => m.id !== meetingId);
                updateScheduledMeetingsList();
                createEasterEgg('🗑️', Math.random() * window.innerWidth, Math.random() * window.innerHeight);
            }
        }
        
        // Stories Functions
        function openStories() {
            document.getElementById('storiesModal').classList.remove('hidden');
        }
        
        function createStory() {
            alert('Fitur Stories akan segera tersedia! Kamu bisa berbagi momen spesial dengan teman-teman! 📸✨');
            createEasterEgg('📸', Math.random() * window.innerWidth, Math.random() * window.innerHeight);
        }
        
        // Games Functions
        function openGames() {
            document.getElementById('gamesModal').classList.remove('hidden');
        }
        
        function startTicTacToe() {
            sendGameMessage('🎮 Tic Tac Toe', 'Ayo main Tic Tac Toe! Siapa yang mau jadi X?', '⭕');
            closeModal('gamesModal');
        }
        
        function startWordGame() {
            const startingWords = ['APEL', 'BUKU', 'CINTA', 'DUNIA', 'ELANG'];
            const randomWord = startingWords[Math.floor(Math.random() * startingWords.length)];
            const lastLetter = randomWord.slice(-1);
            
            window.currentWordGame = {
                currentWord: randomWord,
                nextLetter: lastLetter,
                wordsUsed: [randomWord]
            };
            
            sendWordGameMessage(randomWord, lastLetter);
            closeModal('gamesModal');
        }
        
        function sendWordGameMessage(word, nextLetter) {
            const chatMessages = document.getElementById('chatMessages');
            
            // Remove empty state if it exists
            const emptyState = chatMessages.querySelector('.text-center.py-12');
            if (emptyState) {
                emptyState.remove();
            }
            
            const messageDiv = document.createElement('div');
            messageDiv.className = 'chat-bubble word-game';
            messageDiv.innerHTML = `
                <div class="flex items-start space-x-3">
                    <div class="w-8 h-8 rounded-full bg-yellow-400 flex items-center justify-center text-white text-sm">📝</div>
                    <div class="flex-1">
                        <div class="glass-effect rounded-2xl p-4 max-w-md">
                            <div class="flex items-center space-x-2 mb-3">
                                <span class="text-lg">📝</span>
                                <span class="font-semibold text-gray-800">Word Chain</span>
                            </div>
                            <div class="mb-4">
                                <p class="text-sm text-gray-700 mb-2">Kata saat ini: <strong class="text-lg text-purple-600">${word}</strong></p>
                                <p class="text-sm text-gray-600 mb-3">Kata selanjutnya harus dimulai dengan huruf: <strong class="text-lg text-red-500">${nextLetter}</strong></p>
                                <div class="flex space-x-2">
                                    <input type="text" id="wordInput" placeholder="Masukkan kata..." class="flex-1 px-3 py-2 rounded-lg glass-effect border-0 text-sm focus:ring-2 focus:ring-purple-300 focus:outline-none">
                                    <button onclick="submitWord()" class="px-4 py-2 rounded-lg gradient-bg text-white text-sm hover:opacity-90">Kirim</button>
                                </div>
                            </div>
                            <div class="text-xs text-gray-600">💡 Kata harus dimulai dengan huruf ${nextLetter}!</div>
                        </div>
                    </div>
                </div>
            `;
            
            chatMessages.appendChild(messageDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
            
            // Focus on input
            setTimeout(() => {
                const input = document.getElementById('wordInput');
                if (input) input.focus();
            }, 100);
            
            createEasterEgg('📝', Math.random() * window.innerWidth, Math.random() * window.innerHeight);
        }
        
        function submitWord() {
            const input = document.getElementById('wordInput');
            const word = input.value.trim().toUpperCase();
            const gameData = window.currentWordGame;
            
            if (!word) {
                alert('Mohon masukkan kata!');
                return;
            }
            
            if (!word.startsWith(gameData.nextLetter)) {
                alert(`Kata harus dimulai dengan huruf ${gameData.nextLetter}!`);
                return;
            }
            
            if (gameData.wordsUsed.includes(word)) {
                alert('Kata sudah pernah digunakan!');
                return;
            }
            
            // Valid word
            gameData.wordsUsed.push(word);
            gameData.currentWord = word;
            gameData.nextLetter = word.slice(-1);
            
            // Disable current game
            const wordGameDiv = document.querySelector('.word-game');
            if (wordGameDiv) {
                const input = wordGameDiv.querySelector('#wordInput');
                const button = wordGameDiv.querySelector('button');
                if (input) input.disabled = true;
                if (button) button.disabled = true;
            }
            
            // Show success and next challenge
            setTimeout(() => {
                const chatMessages = document.getElementById('chatMessages');
                const resultDiv = document.createElement('div');
                resultDiv.className = 'chat-bubble';
                resultDiv.innerHTML = `
                    <div class="flex items-start space-x-3">
                        <div class="w-8 h-8 rounded-full bg-green-400 flex items-center justify-center text-white text-sm">✅</div>
                        <div class="flex-1">
                            <div class="glass-effect rounded-2xl p-4 max-w-md bg-green-50">
                                <div class="flex items-center space-x-2 mb-2">
                                    <span class="text-lg">🎉</span>
                                    <span class="font-semibold text-gray-800">Bagus!</span>
                                </div>
                                <p class="text-sm text-gray-700 mb-3">Kata <strong>${word}</strong> diterima! Kata yang sudah digunakan: ${gameData.wordsUsed.join(', ')}</p>
                                <button onclick="continueWordGame()" class="w-full py-2 rounded-xl gradient-bg text-white text-sm hover:opacity-90">
                                    📝 Lanjutkan Game
                                </button>
                            </div>
                        </div>
                    </div>
                `;
                
                chatMessages.appendChild(resultDiv);
                chatMessages.scrollTop = chatMessages.scrollHeight;
                createEasterEgg('🎉', Math.random() * window.innerWidth, Math.random() * window.innerHeight);
            }, 500);
        }
        
        function continueWordGame() {
            const gameData = window.currentWordGame;
            sendWordGameMessage(gameData.currentWord, gameData.nextLetter);
        }
        
        function startTrivia() {
            const questions = [
                {
                    question: 'Siapa presiden pertama Indonesia?',
                    answer: 'soekarno',
                    options: ['Soekarno', 'Soeharto', 'Habibie', 'Megawati']
                },
                {
                    question: 'Apa ibu kota Australia?',
                    answer: 'canberra',
                    options: ['Sydney', 'Melbourne', 'Canberra', 'Perth']
                },
                {
                    question: 'Planet mana yang terdekat dengan matahari?',
                    answer: 'merkurius',
                    options: ['Venus', 'Merkurius', 'Mars', 'Bumi']
                },
                {
                    question: 'Berapa jumlah provinsi di Indonesia saat ini?',
                    answer: '38',
                    options: ['34', '36', '38', '40']
                },
                {
                    question: 'Siapa penemu lampu pijar?',
                    answer: 'thomas edison',
                    options: ['Thomas Edison', 'Nikola Tesla', 'Alexander Bell', 'Albert Einstein']
                }
            ];
            
            const randomQuestion = questions[Math.floor(Math.random() * questions.length)];
            window.currentTriviaQuestion = randomQuestion; // Store current question
            
            sendTriviaQuestion(randomQuestion);
            closeModal('gamesModal');
        }
        
        function startDrawingGame() {
            sendGameMessage('🎨 Guess Drawing', 'Game menggambar dimulai! Seseorang gambar, yang lain tebak!', '🎨');
            closeModal('gamesModal');
        }
        
        function startRockPaperScissors() {
            sendRPSGame();
            closeModal('gamesModal');
        }
        
        function sendRPSGame() {
            const chatMessages = document.getElementById('chatMessages');
            
            // Remove empty state if it exists
            const emptyState = chatMessages.querySelector('.text-center.py-12');
            if (emptyState) {
                emptyState.remove();
            }
            
            const messageDiv = document.createElement('div');
            messageDiv.className = 'chat-bubble rps-game';
            messageDiv.innerHTML = `
                <div class="flex items-start space-x-3">
                    <div class="w-8 h-8 rounded-full bg-orange-400 flex items-center justify-center text-white text-sm">✂️</div>
                    <div class="flex-1">
                        <div class="glass-effect rounded-2xl p-4 max-w-md">
                            <div class="flex items-center space-x-2 mb-3">
                                <span class="text-lg">✂️</span>
                                <span class="font-semibold text-gray-800">Gunting Batu Kertas</span>
                            </div>
                            <div class="mb-4">
                                <p class="text-sm text-gray-700 mb-3">Pilih senjata kamu!</p>
                                <div class="grid grid-cols-3 gap-2">
                                    <button onclick="playRPS('🗿', 'Batu')" class="p-4 rounded-lg glass-effect hover:bg-white/30 transition-all text-center">
                                        <div class="text-3xl mb-1">🗿</div>
                                        <div class="text-xs">Batu</div>
                                    </button>
                                    <button onclick="playRPS('📄', 'Kertas')" class="p-4 rounded-lg glass-effect hover:bg-white/30 transition-all text-center">
                                        <div class="text-3xl mb-1">📄</div>
                                        <div class="text-xs">Kertas</div>
                                    </button>
                                    <button onclick="playRPS('✂️', 'Gunting')" class="p-4 rounded-lg glass-effect hover:bg-white/30 transition-all text-center">
                                        <div class="text-3xl mb-1">✂️</div>
                                        <div class="text-xs">Gunting</div>
                                    </button>
                                </div>
                            </div>
                            <div class="text-xs text-gray-600">🎯 Pilih salah satu untuk melawan komputer!</div>
                        </div>
                    </div>
                </div>
            `;
            
            chatMessages.appendChild(messageDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
            
            createEasterEgg('✂️', Math.random() * window.innerWidth, Math.random() * window.innerHeight);
        }
        
        function playRPS(playerChoice, playerName) {
            const choices = [
                { emoji: '🗿', name: 'Batu' },
                { emoji: '📄', name: 'Kertas' },
                { emoji: '✂️', name: 'Gunting' }
            ];
            
            const computerChoice = choices[Math.floor(Math.random() * choices.length)];
            
            // Disable current game
            const rpsGameDiv = document.querySelector('.rps-game');
            if (rpsGameDiv) {
                const buttons = rpsGameDiv.querySelectorAll('button');
                buttons.forEach(btn => btn.disabled = true);
            }
            
            // Determine winner
            let result = '';
            let resultEmoji = '';
            let resultColor = '';
            
            if (playerChoice === computerChoice.emoji) {
                result = 'Seri!';
                resultEmoji = '🤝';
                resultColor = 'bg-yellow-50';
            } else if (
                (playerChoice === '🗿' && computerChoice.emoji === '✂️') ||
                (playerChoice === '📄' && computerChoice.emoji === '🗿') ||
                (playerChoice === '✂️' && computerChoice.emoji === '📄')
            ) {
                result = 'Kamu Menang!';
                resultEmoji = '🎉';
                resultColor = 'bg-green-50';
            } else {
                result = 'Komputer Menang!';
                resultEmoji = '😅';
                resultColor = 'bg-red-50';
            }
            
            // Show result
            setTimeout(() => {
                const chatMessages = document.getElementById('chatMessages');
                const resultDiv = document.createElement('div');
                resultDiv.className = 'chat-bubble';
                resultDiv.innerHTML = `
                    <div class="flex items-start space-x-3">
                        <div class="w-8 h-8 rounded-full bg-purple-400 flex items-center justify-center text-white text-sm">${resultEmoji}</div>
                        <div class="flex-1">
                            <div class="glass-effect rounded-2xl p-4 max-w-md ${resultColor}">
                                <div class="flex items-center space-x-2 mb-3">
                                    <span class="text-lg">${resultEmoji}</span>
                                    <span class="font-semibold text-gray-800">${result}</span>
                                </div>
                                <div class="flex items-center justify-center space-x-8 mb-3">
                                    <div class="text-center">
                                        <div class="text-4xl mb-1">${playerChoice}</div>
                                        <div class="text-sm text-gray-600">Kamu</div>
                                    </div>
                                    <div class="text-2xl">VS</div>
                                    <div class="text-center">
                                        <div class="text-4xl mb-1">${computerChoice.emoji}</div>
                                        <div class="text-sm text-gray-600">Komputer</div>
                                    </div>
                                </div>
                                <button onclick="startRockPaperScissors()" class="w-full py-2 rounded-xl gradient-bg text-white text-sm hover:opacity-90">
                                    ✂️ Main Lagi
                                </button>
                            </div>
                        </div>
                    </div>
                `;
                
                chatMessages.appendChild(resultDiv);
                chatMessages.scrollTop = chatMessages.scrollHeight;
                createEasterEgg(resultEmoji, Math.random() * window.innerWidth, Math.random() * window.innerHeight);
            }, 1000);
        }
        
        function startMemoryGame() {
            sendGameMessage('🧩 Memory Match', 'Game Memory Match! Ingat urutan emoji ini: 🐱🐶🐰🦊 Sekarang ulangi!', '🧩');
            closeModal('gamesModal');
        }
        
        function sendGameMessage(title, content, emoji) {
            const chatMessages = document.getElementById('chatMessages');
            
            // Remove empty state if it exists
            const emptyState = chatMessages.querySelector('.text-center.py-12');
            if (emptyState) {
                emptyState.remove();
            }
            
            const messageDiv = document.createElement('div');
            messageDiv.className = 'chat-bubble';
            messageDiv.innerHTML = `
                <div class="flex items-start space-x-3">
                    <div class="w-8 h-8 rounded-full bg-green-400 flex items-center justify-center text-white text-sm">${emoji}</div>
                    <div class="flex-1">
                        <div class="glass-effect rounded-2xl p-4 max-w-md">
                            <div class="flex items-center space-x-2 mb-2">
                                <span class="text-lg">${emoji}</span>
                                <span class="font-semibold text-gray-800">${title}</span>
                            </div>
                            <p class="text-sm text-gray-700">${content}</p>
                        </div>
                    </div>
                </div>
            `;
            
            chatMessages.appendChild(messageDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
            
            createEasterEgg(emoji, Math.random() * window.innerWidth, Math.random() * window.innerHeight);
        }
        
        function sendTriviaQuestion(questionData) {
            const chatMessages = document.getElementById('chatMessages');
            
            // Remove empty state if it exists
            const emptyState = chatMessages.querySelector('.text-center.py-12');
            if (emptyState) {
                emptyState.remove();
            }
            
            const messageDiv = document.createElement('div');
            messageDiv.className = 'chat-bubble trivia-question';
            messageDiv.innerHTML = `
                <div class="flex items-start space-x-3">
                    <div class="w-8 h-8 rounded-full bg-blue-400 flex items-center justify-center text-white text-sm">🧠</div>
                    <div class="flex-1">
                        <div class="glass-effect rounded-2xl p-4 max-w-md">
                            <div class="flex items-center space-x-2 mb-3">
                                <span class="text-lg">🧠</span>
                                <span class="font-semibold text-gray-800">Trivia Quiz</span>
                            </div>
                            <div class="mb-4">
                                <p class="text-sm font-medium text-gray-800 mb-3">${questionData.question}</p>
                                <div class="space-y-2">
                                    ${questionData.options.map((option, index) => 
                                        `<button onclick="answerTrivia('${option}', this)" class="w-full text-left p-2 rounded-lg hover:bg-white/20 transition-all border border-white/30 text-sm">
                                            ${String.fromCharCode(65 + index)}. ${option}
                                        </button>`
                                    ).join('')}
                                </div>
                            </div>
                            <div class="text-xs text-gray-600">💡 Pilih jawaban yang benar!</div>
                        </div>
                    </div>
                </div>
            `;
            
            chatMessages.appendChild(messageDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
            
            createEasterEgg('🧠', Math.random() * window.innerWidth, Math.random() * window.innerHeight);
        }
        
        function answerTrivia(selectedAnswer, buttonElement) {
            const currentQuestion = window.currentTriviaQuestion;
            if (!currentQuestion) return;
            
            const isCorrect = selectedAnswer.toLowerCase() === currentQuestion.answer.toLowerCase();
            const triviaDiv = buttonElement.closest('.trivia-question');
            
            // Disable all buttons
            const buttons = triviaDiv.querySelectorAll('button');
            buttons.forEach(btn => {
                btn.disabled = true;
                btn.classList.remove('hover:bg-white/20');
                
                // Highlight correct and wrong answers
                if (btn.textContent.includes(selectedAnswer)) {
                    if (isCorrect) {
                        btn.classList.add('bg-green-400', 'text-white');
                    } else {
                        btn.classList.add('bg-red-400', 'text-white');
                    }
                } else if (btn.textContent.toLowerCase().includes(currentQuestion.answer.toLowerCase())) {
                    btn.classList.add('bg-green-400', 'text-white');
                }
            });
            
            // Show result message
            setTimeout(() => {
                const chatMessages = document.getElementById('chatMessages');
                const resultDiv = document.createElement('div');
                resultDiv.className = 'chat-bubble';
                
                if (isCorrect) {
                    resultDiv.innerHTML = `
                        <div class="flex items-start space-x-3">
                            <div class="w-8 h-8 rounded-full bg-green-400 flex items-center justify-center text-white text-sm">✅</div>
                            <div class="flex-1">
                                <div class="glass-effect rounded-2xl p-4 max-w-md bg-green-50">
                                    <div class="flex items-center space-x-2 mb-2">
                                        <span class="text-lg">🎉</span>
                                        <span class="font-semibold text-gray-800">Benar!</span>
                                    </div>
                                    <p class="text-sm text-gray-700 mb-3">Selamat! Jawaban kamu benar: <strong>${selectedAnswer}</strong></p>
                                    <button onclick="startTrivia()" class="w-full py-2 rounded-xl gradient-bg text-white text-sm hover:opacity-90">
                                        🧠 Pertanyaan Berikutnya
                                    </button>
                                </div>
                            </div>
                        </div>
                    `;
                    createEasterEgg('🎉', Math.random() * window.innerWidth, Math.random() * window.innerHeight);
                } else {
                    resultDiv.innerHTML = `
                        <div class="flex items-start space-x-3">
                            <div class="w-8 h-8 rounded-full bg-red-400 flex items-center justify-center text-white text-sm">❌</div>
                            <div class="flex-1">
                                <div class="glass-effect rounded-2xl p-4 max-w-md bg-red-50">
                                    <div class="flex items-center space-x-2 mb-2">
                                        <span class="text-lg">😅</span>
                                        <span class="font-semibold text-gray-800">Salah!</span>
                                    </div>
                                    <p class="text-sm text-gray-700 mb-3">Jawaban yang benar adalah: <strong>${currentQuestion.options.find(opt => opt.toLowerCase() === currentQuestion.answer.toLowerCase())}</strong></p>
                                    <button onclick="startTrivia()" class="w-full py-2 rounded-xl gradient-bg text-white text-sm hover:opacity-90">
                                        🧠 Coba Lagi
                                    </button>
                                </div>
                            </div>
                        </div>
                    `;
                    createEasterEgg('💪', Math.random() * window.innerWidth, Math.random() * window.innerHeight);
                }
                
                chatMessages.appendChild(resultDiv);
                chatMessages.scrollTop = chatMessages.scrollHeight;
            }, 1000);
        }
        
        // Voice Message Function
        function sendVoiceMessage() {
            alert('Fitur Voice Message akan segera tersedia! 🎤✨');
            createEasterEgg('🎤', Math.random() * window.innerWidth, Math.random() * window.innerHeight);
        }
        
        // Poll Functions
        function createPoll() {
            document.getElementById('pollModal').classList.remove('hidden');
        }
        
        function addPollOption() {
            const pollOptions = document.getElementById('pollOptions');
            const optionCount = pollOptions.children.length + 1;
            
            const input = document.createElement('input');
            input.type = 'text';
            input.placeholder = `Pilihan ${optionCount}`;
            input.className = 'w-full px-4 py-2 rounded-xl glass-effect border-0 focus:ring-2 focus:ring-purple-300 focus:outline-none';
            
            pollOptions.appendChild(input);
        }
        
        function createPollMessage() {
            const question = document.getElementById('pollQuestion').value.trim();
            const optionInputs = document.querySelectorAll('#pollOptions input');
            const options = Array.from(optionInputs).map(input => input.value.trim()).filter(option => option);
            
            if (!question || options.length < 2) {
                alert('Mohon isi pertanyaan dan minimal 2 pilihan jawaban!');
                return;
            }
            
            const chatMessages = document.getElementById('chatMessages');
            
            // Remove empty state if it exists
            const emptyState = chatMessages.querySelector('.text-center.py-12');
            if (emptyState) {
                emptyState.remove();
            }
            
            const messageDiv = document.createElement('div');
            messageDiv.className = 'chat-bubble';
            
            let optionsHTML = options.map((option, index) => 
                `<button onclick="votePoll(this, '${option}')" class="w-full text-left p-2 rounded-lg hover:bg-white/20 transition-all border border-white/30 mb-2">
                    <span class="text-sm">${option}</span>
                    <div class="text-xs text-gray-300 mt-1">0 suara (0%)</div>
                </button>`
            ).join('');
            
            messageDiv.innerHTML = `
                <div class="flex items-start space-x-3 flex-row-reverse">
                    <div class="w-8 h-8 rounded-full bg-purple-400 flex-shrink-0"></div>
                    <div class="text-right">
                        <div class="flex items-center space-x-2 mb-1 justify-end">
                            <span class="text-xs text-gray-500">${new Date().toLocaleTimeString('id-ID', {hour: '2-digit', minute: '2-digit'})}</span>
                            <span class="font-medium text-gray-800">${userSettings.displayName}</span>
                        </div>
                        <div class="bg-gradient-to-r from-blue-400 to-purple-400 text-white rounded-2xl rounded-tr-md p-4 max-w-md">
                            <div class="flex items-center space-x-2 mb-3">
                                <span class="text-lg">📊</span>
                                <span class="font-semibold">Poll</span>
                            </div>
                            <h4 class="font-medium mb-3">${question}</h4>
                            <div class="space-y-2">
                                ${optionsHTML}
                            </div>
                            <div class="text-xs text-gray-200 mt-3">Total: 0 suara</div>
                        </div>
                    </div>
                </div>
            `;
            
            chatMessages.appendChild(messageDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
            
            // Clear form
            document.getElementById('pollQuestion').value = '';
            document.getElementById('pollOptions').innerHTML = `
                <input type="text" placeholder="Pilihan 1" class="w-full px-4 py-2 rounded-xl glass-effect border-0 focus:ring-2 focus:ring-purple-300 focus:outline-none">
                <input type="text" placeholder="Pilihan 2" class="w-full px-4 py-2 rounded-xl glass-effect border-0 focus:ring-2 focus:ring-purple-300 focus:outline-none">
            `;
            
            closeModal('pollModal');
            createEasterEgg('📊', Math.random() * window.innerWidth, Math.random() * window.innerHeight);
        }
        
        function votePoll(button, option) {
            // Simple voting simulation
            const currentVotes = parseInt(button.querySelector('.text-xs').textContent.match(/\d+/)[0]) + 1;
            button.querySelector('.text-xs').textContent = `${currentVotes} suara`;
            
            // Update total
            const pollDiv = button.closest('.bg-gradient-to-r');
            const totalDiv = pollDiv.querySelector('.text-xs.text-gray-200');
            const currentTotal = parseInt(totalDiv.textContent.match(/\d+/)[0]) + 1;
            totalDiv.textContent = `Total: ${currentTotal} suara`;
            
            createEasterEgg('✅', Math.random() * window.innerWidth, Math.random() * window.innerHeight);
        }







        // Settings Functions
        function openSettings() {
            document.getElementById('settingsModal').classList.remove('hidden');
            loadCurrentSettings();
        }
        
        function loadCurrentSettings() {
            // Load current user settings into the form
            document.getElementById('displayName').value = userSettings.displayName;
            document.getElementById('userStatus').value = userSettings.status;
            document.getElementById('userBio').value = userSettings.bio;
            document.getElementById('fontSize').value = userSettings.fontSize;
            document.getElementById('soundNotif').checked = userSettings.soundNotif;
            document.getElementById('desktopNotif').checked = userSettings.desktopNotif;
            document.getElementById('messagePreview').checked = userSettings.messagePreview;
            document.getElementById('messagePrivacy').value = userSettings.messagePrivacy;
            document.getElementById('showOnlineStatus').checked = userSettings.showOnlineStatus;
        }
        
        function saveSettings() {
            // Save settings from form
            userSettings.displayName = document.getElementById('displayName').value || userSettings.displayName;
            userSettings.status = document.getElementById('userStatus').value;
            userSettings.bio = document.getElementById('userBio').value;
            userSettings.fontSize = document.getElementById('fontSize').value;
            userSettings.soundNotif = document.getElementById('soundNotif').checked;
            userSettings.desktopNotif = document.getElementById('desktopNotif').checked;
            userSettings.messagePreview = document.getElementById('messagePreview').checked;
            userSettings.messagePrivacy = document.getElementById('messagePrivacy').value;
            userSettings.showOnlineStatus = document.getElementById('showOnlineStatus').checked;
            
            // Update display name in header
            document.getElementById('userDisplayName').textContent = userSettings.displayName;
            
            // Apply font size
            applyFontSize(userSettings.fontSize);
            
            closeModal('settingsModal');
            alert('Pengaturan berhasil disimpan! ✅');
            createEasterEgg('✅', Math.random() * window.innerWidth, Math.random() * window.innerHeight);
        }
        
        function resetSettings() {
            if (confirm('Yakin ingin reset semua pengaturan ke default?')) {
                userSettings = {
                    displayName: currentUser ? currentUser.split('@')[0] : 'User',
                    status: 'online',
                    bio: '',
                    theme: 'pastel-blue',
                    fontSize: 'medium',
                    soundNotif: true,
                    desktopNotif: true,
                    messagePreview: true,
                    messagePrivacy: 'friends',
                    showOnlineStatus: true
                };
                
                loadCurrentSettings();
                changeTheme('pastel-blue');
                applyFontSize('medium');
                
                alert('Pengaturan berhasil direset! 🔄');
                createEasterEgg('🔄', Math.random() * window.innerWidth, Math.random() * window.innerHeight);
            }
        }
        
        function changeTheme(theme) {
            userSettings.theme = theme;
            
            // Apply theme to body
            const body = document.body;
            
            // Remove existing theme classes
            const themeClasses = ['pastel-blue', 'pastel-pink', 'pastel-purple', 'sunset-theme', 'ocean-theme', 'forest-theme'];
            themeClasses.forEach(cls => body.classList.remove(cls));
            
            // Add new theme class
            body.classList.add(theme);
            
            // Also update CSS custom properties for immediate effect
            const root = document.documentElement;
            switch(theme) {
                case 'pastel-blue':
                    root.style.setProperty('--theme-bg', 'linear-gradient(135deg, #a8edea 0%, #fed6e3 100%)');
                    break;
                case 'pastel-pink':
                    root.style.setProperty('--theme-bg', 'linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%)');
                    break;
                case 'pastel-purple':
                    root.style.setProperty('--theme-bg', 'linear-gradient(135deg, #d299c2 0%, #fef9d7 100%)');
                    break;
                case 'sunset-theme':
                    root.style.setProperty('--theme-bg', 'linear-gradient(135deg, #ff9a9e 0%, #fad0c4 100%)');
                    break;
                case 'ocean-theme':
                    root.style.setProperty('--theme-bg', 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)');
                    break;
                case 'forest-theme':
                    root.style.setProperty('--theme-bg', 'linear-gradient(135deg, #d4fc79 0%, #96e6a1 100%)');
                    break;
            }
            
            // Apply background immediately
            body.style.background = root.style.getPropertyValue('--theme-bg');
            
            createEasterEgg('🎨', Math.random() * window.innerWidth, Math.random() * window.innerHeight);
            
            // Show success message
            setTimeout(() => {
                alert('Tema berhasil diubah! 🎨✨');
            }, 100);
        }
        
        function applyFontSize(size) {
            const root = document.documentElement;
            switch(size) {
                case 'small':
                    root.style.fontSize = '14px';
                    break;
                case 'large':
                    root.style.fontSize = '18px';
                    break;
                default:
                    root.style.fontSize = '16px';
            }
        }

        // Logo Cycling Function
        function cycleLogo() {
            // Hide current logo
            const currentLogo = document.getElementById(`logo${currentLogoIndex}`);
            const currentHeaderLogo = document.getElementById(`headerLogo${currentLogoIndex}`);
            const currentIndicator = document.getElementById(`indicator${currentLogoIndex}`);
            
            if (currentLogo) currentLogo.classList.add('hidden');
            if (currentHeaderLogo) currentHeaderLogo.classList.add('hidden');
            if (currentIndicator) currentIndicator.className = 'w-2 h-2 rounded-full bg-white/30';
            
            // Move to next logo
            currentLogoIndex = currentLogoIndex >= 6 ? 1 : currentLogoIndex + 1;
            
            // Show new logo
            const newLogo = document.getElementById(`logo${currentLogoIndex}`);
            const newHeaderLogo = document.getElementById(`headerLogo${currentLogoIndex}`);
            const newIndicator = document.getElementById(`indicator${currentLogoIndex}`);
            
            if (newLogo) newLogo.classList.remove('hidden');
            if (newHeaderLogo) newHeaderLogo.classList.remove('hidden');
            if (newIndicator) newIndicator.className = 'w-2 h-2 rounded-full bg-white/60';
            
            // Add sparkle effect
            const logoNames = ['Chat Bubbles', 'Modern C', 'Chat Network', 'Speech Wave', 'Hexagon Chat', 'Infinity Chat'];
            const emojis = ['💬', '🔤', '🌐', '📢', '⬡', '♾️'];
            
            createEasterEgg(emojis[currentLogoIndex - 1], Math.random() * window.innerWidth, Math.random() * window.innerHeight);
            
            // Show tooltip
            setTimeout(() => {
                const tooltip = document.createElement('div');
                tooltip.className = 'fixed top-20 left-1/2 transform -translate-x-1/2 glass-effect rounded-2xl px-4 py-2 text-sm text-gray-700 z-50';
                tooltip.textContent = `Logo: ${logoNames[currentLogoIndex - 1]} ${emojis[currentLogoIndex - 1]}`;
                document.body.appendChild(tooltip);
                
                setTimeout(() => {
                    tooltip.remove();
                }, 2000);
            }, 100);
        }

        // Music Player Functions
        function openMusicPlayer() {
            document.getElementById('musicModal').classList.remove('hidden');
            updateMusicDisplay();
        }
        
        function togglePlay() {
            isPlaying = !isPlaying;
            const playBtn = document.getElementById('playBtn');
            
            if (isPlaying) {
                playBtn.innerHTML = '<span class="text-3xl">⏸️</span>';
                createEasterEgg('🎵', Math.random() * window.innerWidth, Math.random() * window.innerHeight);
            } else {
                playBtn.innerHTML = '<span class="text-3xl">▶️</span>';
            }
        }
        
        function previousSong() {
            currentSongIndex = currentSongIndex > 0 ? currentSongIndex - 1 : playlist.length - 1;
            updateMusicDisplay();
            createEasterEgg('⏮️', Math.random() * window.innerWidth, Math.random() * window.innerHeight);
        }
        
        function nextSong() {
            currentSongIndex = currentSongIndex < playlist.length - 1 ? currentSongIndex + 1 : 0;
            updateMusicDisplay();
            createEasterEgg('⏭️', Math.random() * window.innerWidth, Math.random() * window.innerHeight);
        }
        
        function playSong(title, artist) {
            const songIndex = playlist.findIndex(song => song.title === title && song.artist === artist);
            if (songIndex !== -1) {
                currentSongIndex = songIndex;
                updateMusicDisplay();
                isPlaying = true;
                document.getElementById('playBtn').innerHTML = '<span class="text-3xl">⏸️</span>';
                createEasterEgg('🎶', Math.random() * window.innerWidth, Math.random() * window.innerHeight);
            }
        }
        
        function updateMusicDisplay() {
            const currentSong = playlist[currentSongIndex];
            document.getElementById('currentSong').textContent = currentSong.title;
            document.getElementById('currentArtist').textContent = currentSong.artist;
            
            // Update playlist highlighting
            const playlistItems = document.querySelectorAll('#musicModal .space-y-2 > div');
            playlistItems.forEach((item, index) => {
                if (index === currentSongIndex) {
                    item.classList.add('bg-white/10');
                } else {
                    item.classList.remove('bg-white/10');
                }
            });
        }
        
        // Volume control
        document.addEventListener('DOMContentLoaded', function() {
            const volumeSlider = document.getElementById('volumeSlider');
            if (volumeSlider) {
                volumeSlider.addEventListener('input', function() {
                    const volumeText = this.parentElement.querySelector('.text-sm');
                    if (volumeText) {
                        volumeText.textContent = this.value + '%';
                    }
                });
            }
        });
        
        // AI Assistant Functions
        function openAIAssistant() {
            document.getElementById('aiModal').classList.remove('hidden');
        }
        
        function sendAIMessage() {
            const input = document.getElementById('aiInput');
            const message = input.value.trim();
            
            if (message) {
                addAIUserMessage(message);
                input.value = '';
                
                // Simulate AI response
                setTimeout(() => {
                    generateAIResponse(message);
                }, 1000);
                
                aiQuestionCount++;
                updateAIStats();
            }
        }
        
        function handleAIEnter(event) {
            if (event.key === 'Enter') {
                sendAIMessage();
            }
        }
        
        function askAI(question) {
            document.getElementById('aiInput').value = question;
            sendAIMessage();
        }
        
        function addAIUserMessage(message) {
            const chatMessages = document.getElementById('aiChatMessages');
            const messageDiv = document.createElement('div');
            messageDiv.className = 'flex items-start space-x-3 flex-row-reverse';
            messageDiv.innerHTML = `
                <div class="w-8 h-8 rounded-full bg-purple-400 flex-shrink-0"></div>
                <div class="glass-effect rounded-2xl p-3 max-w-md bg-purple-100">
                    <p class="text-gray-800">${message}</p>
                </div>
            `;
            chatMessages.appendChild(messageDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }
        
        function generateAIResponse(userMessage) {
            const responses = {
                'tips produktivitas': {
                    text: 'Berikut tips produktivitas untuk hari ini:\n\n• 🍅 Gunakan teknik Pomodoro (25 menit fokus, 5 menit istirahat)\n• 📝 Buat to-do list di pagi hari\n• 🎯 Fokus pada 3 tugas penting saja\n• 📱 Matikan notifikasi yang tidak penting\n• 🌱 Mulai dengan tugas yang paling sulit\n• ☕ Jaga hidrasi dan istirahat teratur',
                    emoji: '💡'
                },
                'joke': {
                    text: 'Nih joke lucu buat kamu! 😄\n\nKenapa programmer suka kopi?\nKarena tanpa kopi, mereka cuma bisa bikin "Java" script! ☕😂\n\nAtau yang ini:\nAda berapa programmer yang dibutuhkan untuk mengganti lampu?\nTidak ada, itu masalah hardware! 💡🔧',
                    emoji: '😂'
                },
                'motivasi': {
                    text: 'Semangat untuk hari ini! 🔥\n\n"Kesuksesan bukan tentang seberapa cepat kamu sampai, tapi seberapa konsisten kamu melangkah."\n\n• 💪 Kamu lebih kuat dari yang kamu kira\n• 🌟 Setiap langkah kecil adalah kemajuan\n• 🚀 Hari ini adalah kesempatan baru untuk berkembang\n• ✨ Percaya pada prosesmu!\n\nKamu pasti bisa! 💖',
                    emoji: '🔥'
                },
                'weekend': {
                    text: 'Ide seru untuk weekend kamu! 🎉\n\n🏞️ Outdoor:\n• Piknik di taman\n• Hiking ringan\n• Fotografi jalanan\n\n🏠 Indoor:\n• Masak resep baru\n• Binge-watch series favorit\n• Baca buku menarik\n\n👥 Bareng teman:\n• Board game night\n• Karaoke\n• Nonton bioskop\n\nPilih yang paling cocok dengan mood kamu! 😊',
                    emoji: '🎉'
                }
            };
            
            let response = responses['default'] || {
                text: 'Terima kasih sudah bertanya! 😊 Saya akan terus belajar untuk memberikan jawaban yang lebih baik. Apakah ada hal lain yang bisa saya bantu?',
                emoji: '🤖'
            };
            
            // Simple keyword matching
            const lowerMessage = userMessage.toLowerCase();
            if (lowerMessage.includes('produktivitas') || lowerMessage.includes('tips')) {
                response = responses['tips produktivitas'];
                tipsCount++;
            } else if (lowerMessage.includes('joke') || lowerMessage.includes('lucu')) {
                response = responses['joke'];
            } else if (lowerMessage.includes('motivasi') || lowerMessage.includes('semangat')) {
                response = responses['motivasi'];
                tipsCount++;
            } else if (lowerMessage.includes('weekend') || lowerMessage.includes('aktivitas')) {
                response = responses['weekend'];
                tipsCount++;
            }
            
            const chatMessages = document.getElementById('aiChatMessages');
            const messageDiv = document.createElement('div');
            messageDiv.className = 'flex items-start space-x-3';
            messageDiv.innerHTML = `
                <div class="w-8 h-8 rounded-full gradient-bg flex items-center justify-center text-white text-sm">🤖</div>
                <div class="glass-effect rounded-2xl p-4 max-w-md">
                    <div class="flex items-center space-x-2 mb-2">
                        <span class="text-lg">${response.emoji}</span>
                        <span class="font-medium text-gray-800">Chatty</span>
                    </div>
                    <p class="text-gray-800 whitespace-pre-line">${response.text}</p>
                </div>
            `;
            chatMessages.appendChild(messageDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
            
            createEasterEgg(response.emoji, Math.random() * window.innerWidth, Math.random() * window.innerHeight);
            updateAIStats();
        }
        
        function translateText() {
            const fromLang = document.getElementById('translateFrom').value;
            const toLang = document.getElementById('translateTo').value;
            const text = document.getElementById('translateText').value.trim();
            
            if (!text) {
                alert('Mohon masukkan teks yang ingin diterjemahkan!');
                return;
            }
            
            // Simple translation simulation
            const translations = {
                'id-en': {
                    'halo': 'hello',
                    'selamat pagi': 'good morning',
                    'terima kasih': 'thank you',
                    'sampai jumpa': 'see you later'
                },
                'en-id': {
                    'hello': 'halo',
                    'good morning': 'selamat pagi',
                    'thank you': 'terima kasih',
                    'see you later': 'sampai jumpa'
                }
            };
            
            const translationKey = `${fromLang}-${toLang}`;
            const lowerText = text.toLowerCase();
            let translatedText = translations[translationKey]?.[lowerText] || `[Terjemahan ${text} dari ${fromLang} ke ${toLang}]`;
            
            // Add translation to AI chat
            addAIUserMessage(`Terjemahkan: "${text}" (${fromLang} → ${toLang})`);
            
            setTimeout(() => {
                const chatMessages = document.getElementById('aiChatMessages');
                const messageDiv = document.createElement('div');
                messageDiv.className = 'flex items-start space-x-3';
                messageDiv.innerHTML = `
                    <div class="w-8 h-8 rounded-full gradient-bg flex items-center justify-center text-white text-sm">🌍</div>
                    <div class="glass-effect rounded-2xl p-4 max-w-md">
                        <div class="flex items-center space-x-2 mb-2">
                            <span class="text-lg">🌍</span>
                            <span class="font-medium text-gray-800">Translator</span>
                        </div>
                        <div class="space-y-2">
                            <div class="text-sm text-gray-600">Hasil terjemahan:</div>
                            <div class="p-2 bg-white/20 rounded-lg">
                                <p class="font-medium text-gray-800">${translatedText}</p>
                            </div>
                        </div>
                    </div>
                `;
                chatMessages.appendChild(messageDiv);
                chatMessages.scrollTop = chatMessages.scrollHeight;
            }, 800);
            
            translationCount++;
            updateAIStats();
            createEasterEgg('🌍', Math.random() * window.innerWidth, Math.random() * window.innerHeight);
            
            // Clear the input
            document.getElementById('translateText').value = '';
        }
        
        function updateAIStats() {
            const statsElements = document.querySelectorAll('#aiModal .space-y-2.text-sm .font-medium');
            if (statsElements.length >= 3) {
                statsElements[0].textContent = aiQuestionCount;
                statsElements[1].textContent = translationCount;
                statsElements[2].textContent = tipsCount;
            }
        }

        // Invite Friends to Room Functions
        function inviteFriendsToRoom() {
            document.getElementById('inviteRoomModal').classList.remove('hidden');
            
            // Update room info
            const roomTitles = {
                'general': 'General Chat',
                'study': 'Study Group', 
                'gaming': 'Gaming Zone'
            };
            
            document.getElementById('inviteRoomName').textContent = roomTitles[currentRoom] || currentRoom;
            document.getElementById('roomLink').textContent = `https://chitchat.com/room/${currentRoom}-${Math.random().toString(36).substr(2, 6)}`;
            
            // Clear previous data
            inviteEmails = [];
            updateInviteEmailsList();
        }
        
        function addInviteEmail() {
            const email = document.getElementById('inviteEmail').value.trim();
            if (email && !inviteEmails.includes(email)) {
                inviteEmails.push(email);
                updateInviteEmailsList();
                document.getElementById('inviteEmail').value = '';
            }
        }
        
        function updateInviteEmailsList() {
            const list = document.getElementById('inviteEmailsList');
            list.innerHTML = '';
            
            inviteEmails.forEach((email, index) => {
                const emailDiv = document.createElement('div');
                emailDiv.className = 'flex items-center justify-between glass-effect rounded-xl p-2';
                emailDiv.innerHTML = `
                    <span class="text-sm text-gray-700">${email}</span>
                    <button onclick="removeInviteEmail(${index})" class="text-red-500 hover:text-red-700 text-sm">✕</button>
                `;
                list.appendChild(emailDiv);
            });
        }
        
        function removeInviteEmail(index) {
            inviteEmails.splice(index, 1);
            updateInviteEmailsList();
        }
        
        function copyRoomLink() {
            const roomLink = document.getElementById('roomLink').textContent;
            navigator.clipboard.writeText(roomLink).then(() => {
                alert('Link room berhasil dicopy! 📋✨');
                createEasterEgg('📋', Math.random() * window.innerWidth, Math.random() * window.innerHeight);
            }).catch(() => {
                // Fallback for older browsers
                const textArea = document.createElement('textarea');
                textArea.value = roomLink;
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand('copy');
                document.body.removeChild(textArea);
                alert('Link room berhasil dicopy! 📋✨');
                createEasterEgg('📋', Math.random() * window.innerWidth, Math.random() * window.innerHeight);
            });
        }
        
        function sendRoomInvitations() {
            if (inviteEmails.length === 0) {
                alert('Mohon tambahkan minimal 1 email teman!');
                return;
            }
            
            const roomTitles = {
                'general': 'General Chat',
                'study': 'Study Group',
                'gaming': 'Gaming Zone'
            };
            
            const roomName = roomTitles[currentRoom] || currentRoom;
            const message = document.getElementById('inviteMessage').value.trim();
            const roomLink = document.getElementById('roomLink').textContent;
            
            // Send invitation notification to chat
            const chatMessages = document.getElementById('chatMessages');
            
            // Remove empty state if it exists
            const emptyState = chatMessages.querySelector('.text-center.py-12');
            if (emptyState) {
                emptyState.remove();
            }
            
            const messageDiv = document.createElement('div');
            messageDiv.className = 'chat-bubble invitation-message';
            messageDiv.innerHTML = `
                <div class="flex items-start space-x-3 flex-row-reverse">
                    <div class="w-8 h-8 rounded-full bg-purple-400 flex-shrink-0"></div>
                    <div class="text-right">
                        <div class="flex items-center space-x-2 mb-1 justify-end">
                            <span class="text-xs text-gray-500">${new Date().toLocaleTimeString('id-ID', {hour: '2-digit', minute: '2-digit'})}</span>
                            <span class="font-medium text-gray-800">${userSettings.displayName}</span>
                        </div>
                        <div class="bg-gradient-to-r from-green-400 to-blue-400 text-white rounded-2xl rounded-tr-md p-4 max-w-md">
                            <div class="flex items-center space-x-2 mb-2">
                                <span class="text-lg">👥</span>
                                <span class="font-semibold">Undangan Room</span>
                            </div>
                            <div class="space-y-2 text-sm">
                                <div><strong>Room:</strong> ${roomName}</div>
                                <div><strong>Diundang:</strong> ${inviteEmails.length} teman</div>
                                <div class="text-xs opacity-90">${inviteEmails.join(', ')}</div>
                                ${message ? `<div class="mt-2 p-2 bg-white/20 rounded-lg"><em>"${message}"</em></div>` : ''}
                            </div>
                            <div class="text-xs opacity-75 mt-2">📧 Undangan telah dikirim!</div>
                            <button onclick="showInvitationModal('${roomName}', '${message}', '${currentRoom}')" class="mt-2 w-full py-1 px-3 rounded-lg bg-white/20 hover:bg-white/30 text-xs transition-all">
                                👀 Lihat Undangan
                            </button>
                        </div>
                    </div>
                </div>
            `;
            
            chatMessages.appendChild(messageDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
            
            // Store invitation data for friends
            window.currentInvitation = {
                roomId: currentRoom,
                roomName: roomName,
                inviterName: userSettings.displayName,
                message: message,
                inviteEmails: [...inviteEmails]
            };
            
            // Clear form and close modal
            const emailCount = inviteEmails.length;
            inviteEmails = [];
            document.getElementById('inviteMessage').value = '';
            updateInviteEmailsList();
            closeModal('inviteRoomModal');
            
            alert(`Undangan berhasil dikirim ke ${emailCount} teman! Klik tombol "👀 Lihat Undangan" di chat untuk melihat bagaimana teman kamu bisa bergabung! 📧✨`);
            createEasterEgg('📧', Math.random() * window.innerWidth, Math.random() * window.innerHeight);
        }

        // Mobile Sidebar Functions
        function toggleMobileSidebar() {
            const sidebar = document.getElementById('sidebar');
            const mobileMenuBtn = document.getElementById('mobileMenuBtn');
            
            if (sidebar.classList.contains('hidden')) {
                sidebar.classList.remove('hidden');
                sidebar.classList.add('flex');
                mobileMenuBtn.innerHTML = '<span class="text-xl">✕</span><span class="font-medium">Tutup</span>';
            } else {
                sidebar.classList.add('hidden');
                sidebar.classList.remove('flex');
                mobileMenuBtn.innerHTML = '<span class="text-xl">☰</span><span class="font-medium">Menu</span>';
            }
        }
        
        function closeMobileSidebar() {
            if (window.innerWidth < 768) {
                const sidebar = document.getElementById('sidebar');
                const mobileMenuBtn = document.getElementById('mobileMenuBtn');
                
                sidebar.classList.add('hidden');
                sidebar.classList.remove('flex');
                mobileMenuBtn.innerHTML = '<span class="text-xl">☰</span><span class="font-medium">Menu</span>';
            }
        }
        
        // Handle window resize
        window.addEventListener('resize', function() {
            const sidebar = document.getElementById('sidebar');
            const mobileMenuBtn = document.getElementById('mobileMenuBtn');
            
            if (window.innerWidth >= 768) {
                // Desktop view
                sidebar.classList.remove('hidden');
                sidebar.classList.add('flex');
            } else {
                // Mobile view - close sidebar by default
                sidebar.classList.add('hidden');
                sidebar.classList.remove('flex');
                mobileMenuBtn.innerHTML = '<span class="text-xl">☰</span><span class="font-medium">Menu</span>';
            }
        });

        // Friend Invitation Functions
        function showInvitationModal(roomName, message, roomId) {
            const invitationModal = document.createElement('div');
            invitationModal.id = 'friendInvitationModal';
            invitationModal.className = 'fixed inset-0 bg-black/50 flex items-center justify-center z-50';
            invitationModal.innerHTML = `
                <div class="glass-effect rounded-3xl p-6 w-full max-w-md mx-4">
                    <div class="text-center mb-6">
                        <div class="w-16 h-16 mx-auto rounded-full gradient-bg flex items-center justify-center text-3xl mb-4">👥</div>
                        <h3 class="text-xl font-bold text-gray-800 mb-2">Undangan Room</h3>
                        <p class="text-gray-600">Ini yang dilihat teman kamu!</p>
                    </div>
                    
                    <div class="space-y-4 mb-6">
                        <div class="glass-effect rounded-2xl p-4">
                            <div class="flex items-center space-x-3 mb-3">
                                <span class="text-2xl">🏠</span>
                                <div>
                                    <h4 class="font-semibold text-gray-800">${roomName}</h4>
                                    <p class="text-sm text-gray-600">Dari: ${userSettings.displayName}</p>
                                </div>
                            </div>
                            ${message ? `<div class="p-3 bg-white/20 rounded-xl"><p class="text-sm text-gray-700">"${message}"</p></div>` : ''}
                        </div>
                        
                        <div class="text-center">
                            <p class="text-sm text-gray-600 mb-4">Masukkan nama untuk bergabung:</p>
                            <input type="text" id="friendJoinName" placeholder="Nama teman..." class="w-full px-4 py-3 rounded-2xl glass-effect border-0 focus:ring-2 focus:ring-purple-300 focus:outline-none mb-4">
                        </div>
                    </div>
                    
                    <div class="flex space-x-3">
                        <button onclick="closeFriendInvitationModal()" class="flex-1 py-3 px-4 rounded-xl border border-gray-300 text-gray-700 hover:bg-gray-50">Tutup</button>
                        <button onclick="simulateJoinRoom('${roomId}', '${roomName}')" class="flex-1 py-3 px-4 rounded-xl gradient-bg text-white hover:opacity-90">🚀 Simulasi Bergabung</button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(invitationModal);
        }
        
        function closeFriendInvitationModal() {
            const modal = document.getElementById('friendInvitationModal');
            if (modal) {
                modal.remove();
            }
        }
        
        function simulateJoinRoom(roomId, roomName) {
            const friendName = document.getElementById('friendJoinName').value.trim();
            if (!friendName) {
                alert('Mohon masukkan nama teman!');
                return;
            }
            
            // Close invitation modal
            closeFriendInvitationModal();
            
            // Add friend join notification to chat
            const chatMessages = document.getElementById('chatMessages');
            
            const messageDiv = document.createElement('div');
            messageDiv.className = 'chat-bubble';
            messageDiv.innerHTML = `
                <div class="flex items-start space-x-3">
                    <div class="w-8 h-8 rounded-full bg-green-400 flex items-center justify-center text-white text-sm">🎉</div>
                    <div class="flex-1">
                        <div class="glass-effect rounded-2xl p-4 max-w-md bg-green-50">
                            <div class="flex items-center space-x-2 mb-2">
                                <span class="text-lg">🎉</span>
                                <span class="font-semibold text-gray-800">Teman Bergabung!</span>
                            </div>
                            <p class="text-sm text-gray-700 mb-3"><strong>${friendName}</strong> telah bergabung ke room ${roomName}!</p>
                            <div class="flex items-center space-x-2 text-xs text-gray-600">
                                <span class="w-2 h-2 bg-green-400 rounded-full"></span>
                                <span>Online sekarang</span>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            chatMessages.appendChild(messageDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
            
            // Update room members count
            const roomMembers = document.getElementById('roomMembers');
            const currentCount = parseInt(roomMembers.textContent.match(/\d+/)[0]) || 1;
            roomMembers.textContent = `${currentCount + 1} members online`;
            
            // Add friend message after a delay
            setTimeout(() => {
                const friendMessageDiv = document.createElement('div');
                friendMessageDiv.className = 'chat-bubble';
                friendMessageDiv.innerHTML = `
                    <div class="flex items-start space-x-3">
                        <div class="w-8 h-8 rounded-full bg-blue-400 flex-shrink-0"></div>
                        <div class="flex-1">
                            <div class="flex items-center space-x-2 mb-1">
                                <span class="font-medium text-gray-800">${friendName}</span>
                                <span class="text-xs text-gray-500">${new Date().toLocaleTimeString('id-ID', {hour: '2-digit', minute: '2-digit'})}</span>
                            </div>
                            <div class="bg-white/60 text-gray-800 rounded-2xl rounded-tl-md p-3 max-w-md">
                                <p>Halo! Terima kasih sudah mengundang saya ke room ini! 😊 Senang bisa bergabung!</p>
                            </div>
                        </div>
                    </div>
                `;
                
                chatMessages.appendChild(friendMessageDiv);
                chatMessages.scrollTop = chatMessages.scrollHeight;
                
                createEasterEgg('👋', Math.random() * window.innerWidth, Math.random() * window.innerHeight);
            }, 2000);
            
            alert(`${friendName} berhasil bergabung ke room ${roomName}! 🎉`);
            createEasterEgg('🎉', Math.random() * window.innerWidth, Math.random() * window.innerHeight);
        }
        
        function showInvitationPreview(roomName, message) {
            const invitationModal = document.createElement('div');
            invitationModal.id = 'invitationPreviewModal';
            invitationModal.className = 'fixed inset-0 bg-black/50 flex items-center justify-center z-50';
            invitationModal.innerHTML = `
                <div class="glass-effect rounded-3xl p-6 w-full max-w-md mx-4">
                    <div class="text-center mb-6">
                        <div class="w-16 h-16 mx-auto rounded-full gradient-bg flex items-center justify-center text-3xl mb-4">👥</div>
                        <h3 class="text-xl font-bold text-gray-800 mb-2">Undangan Room</h3>
                        <p class="text-gray-600">Ini yang dilihat teman kamu!</p>
                    </div>
                    
                    <div class="space-y-4 mb-6">
                        <div class="glass-effect rounded-2xl p-4">
                            <div class="flex items-center space-x-3 mb-3">
                                <span class="text-2xl">🏠</span>
                                <div>
                                    <h4 class="font-semibold text-gray-800">${roomName}</h4>
                                    <p class="text-sm text-gray-600">Dari: ${userSettings.displayName}</p>
                                </div>
                            </div>
                            ${message ? `<div class="p-3 bg-white/20 rounded-xl"><p class="text-sm text-gray-700">"${message}"</p></div>` : ''}
                        </div>
                        
                        <div class="text-center">
                            <p class="text-sm text-gray-600 mb-4">Masukkan nama untuk bergabung:</p>
                            <input type="text" id="previewFriendName" placeholder="Nama teman..." class="w-full px-4 py-3 rounded-2xl glass-effect border-0 focus:ring-2 focus:ring-purple-300 focus:outline-none mb-4">
                        </div>
                    </div>
                    
                    <div class="flex space-x-3">
                        <button onclick="closeInvitationPreview()" class="flex-1 py-3 px-4 rounded-xl border border-gray-300 text-gray-700 hover:bg-gray-50">Tutup Preview</button>
                        <button onclick="simulateFriendJoin()" class="flex-1 py-3 px-4 rounded-xl gradient-bg text-white hover:opacity-90">🚀 Simulasi Bergabung</button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(invitationModal);
        }
        
        function closeInvitationPreview() {
            const modal = document.getElementById('invitationPreviewModal');
            if (modal) {
                modal.remove();
            }
        }
        
        function simulateFriendJoin() {
            const friendName = document.getElementById('previewFriendName').value.trim();
            if (!friendName) {
                alert('Mohon masukkan nama teman!');
                return;
            }
            
            // Close preview modal
            closeInvitationPreview();
            
            // Add friend join notification to chat
            const chatMessages = document.getElementById('chatMessages');
            
            // Remove empty state if it exists
            const emptyState = chatMessages.querySelector('.text-center.py-12');
            if (emptyState) {
                emptyState.remove();
            }
            
            const messageDiv = document.createElement('div');
            messageDiv.className = 'chat-bubble';
            messageDiv.innerHTML = `
                <div class="flex items-start space-x-3">
                    <div class="w-8 h-8 rounded-full bg-green-400 flex items-center justify-center text-white text-sm">🎉</div>
                    <div class="flex-1">
                        <div class="glass-effect rounded-2xl p-4 max-w-md bg-green-50">
                            <div class="flex items-center space-x-2 mb-2">
                                <span class="text-lg">🎉</span>
                                <span class="font-semibold text-gray-800">Teman Bergabung!</span>
                            </div>
                            <p class="text-sm text-gray-700 mb-3"><strong>${friendName}</strong> telah bergabung ke room!</p>
                            <div class="flex items-center space-x-2 text-xs text-gray-600">
                                <span class="w-2 h-2 bg-green-400 rounded-full"></span>
                                <span>Online sekarang</span>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            chatMessages.appendChild(messageDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
            
            // Update room members count
            const roomMembers = document.getElementById('roomMembers');
            roomMembers.textContent = '2 members online';
            
            // Add friend message after a delay
            setTimeout(() => {
                const friendMessageDiv = document.createElement('div');
                friendMessageDiv.className = 'chat-bubble';
                friendMessageDiv.innerHTML = `
                    <div class="flex items-start space-x-3">
                        <div class="w-8 h-8 rounded-full bg-blue-400 flex-shrink-0"></div>
                        <div class="flex-1">
                            <div class="flex items-center space-x-2 mb-1">
                                <span class="font-medium text-gray-800">${friendName}</span>
                                <span class="text-xs text-gray-500">${new Date().toLocaleTimeString('id-ID', {hour: '2-digit', minute: '2-digit'})}</span>
                            </div>
                            <div class="bg-white/60 text-gray-800 rounded-2xl rounded-tl-md p-3 max-w-md">
                                <p>Halo! Terima kasih sudah mengundang saya ke room ini! 😊</p>
                            </div>
                        </div>
                    </div>
                `;
                
                chatMessages.appendChild(friendMessageDiv);
                chatMessages.scrollTop = chatMessages.scrollHeight;
                
                createEasterEgg('👋', Math.random() * window.innerWidth, Math.random() * window.innerHeight);
            }, 2000);
            
            alert(`${friendName} berhasil bergabung ke room! 🎉`);
            createEasterEgg('🎉', Math.random() * window.innerWidth, Math.random() * window.innerHeight);
        }
        
        function acceptInvitation(roomId, roomName) {
            const friendName = document.getElementById('friendName').value.trim();
            if (!friendName) {
                alert('Mohon masukkan nama kamu!');
                return;
            }
            
            // Close invitation modal
            const modal = document.getElementById('friendInvitationModal');
            if (modal) {
                modal.remove();
            }
            
            // Join the room
            joinRoom(roomId);
            
            // Add join notification
            const chatMessages = document.getElementById('chatMessages');
            
            // Remove empty state if it exists
            const emptyState = chatMessages.querySelector('.text-center.py-12');
            if (emptyState) {
                emptyState.remove();
            }
            
            const messageDiv = document.createElement('div');
            messageDiv.className = 'chat-bubble';
            messageDiv.innerHTML = `
                <div class="flex items-start space-x-3">
                    <div class="w-8 h-8 rounded-full bg-green-400 flex items-center justify-center text-white text-sm">🎉</div>
                    <div class="flex-1">
                        <div class="glass-effect rounded-2xl p-4 max-w-md bg-green-50">
                            <div class="flex items-center space-x-2 mb-2">
                                <span class="text-lg">🎉</span>
                                <span class="font-semibold text-gray-800">Selamat Datang!</span>
                            </div>
                            <p class="text-sm text-gray-700 mb-3">Kamu berhasil bergabung ke <strong>${roomName}</strong>!</p>
                            <div class="flex items-center space-x-2 text-xs text-gray-600">
                                <span class="w-2 h-2 bg-green-400 rounded-full"></span>
                                <span>Sekarang kamu bisa mulai chat!</span>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            chatMessages.appendChild(messageDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
            
            // Update user name
            userSettings.displayName = friendName;
            document.getElementById('userDisplayName').textContent = friendName;
            
            alert(`Selamat datang di ${roomName}, ${friendName}! 🎉`);
            createEasterEgg('🎉', Math.random() * window.innerWidth, Math.random() * window.innerHeight);
        }
        
        function declineInvitation() {
            const modal = document.getElementById('friendInvitationModal');
            if (modal) {
                modal.remove();
            }
            
            alert('Undangan ditolak. Mungkin lain kali! 😊');
            createEasterEgg('👋', Math.random() * window.innerWidth, Math.random() * window.innerHeight);
        }

        // Initialize app
        document.addEventListener('DOMContentLoaded', function() {
            // Add some initial sparkles
            setTimeout(() => {
                createEasterEgg('✨', window.innerWidth / 2, 100);
            }, 1000);
            
            // Update scheduled meetings list
            updateScheduledMeetingsList();
            
            // Initialize volume slider
            const volumeSlider = document.getElementById('volumeSlider');
            if (volumeSlider) {
                volumeSlider.addEventListener('input', function() {
                    const volumeText = this.parentElement.querySelector('.text-sm');
                    if (volumeText) {
                        volumeText.textContent = this.value + '%';
                    }
                });
            }
            
            // Initialize mobile sidebar state
            if (window.innerWidth < 768) {
                const sidebar = document.getElementById('sidebar');
                sidebar.classList.add('hidden');
                sidebar.classList.remove('flex');
            }
        });
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'96b4d79be748ce5d',t:'MTc1NDU0OTQ1Mi4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script>
<script>
// --- Camera & Mic (if not present) ---
let localVideoStream = null;
let localAudioStream = null;
function toggleCamera() {
    const videoContainer = document.querySelector("#videoArea .grid > div:first-child");
    if (!localVideoStream) {
        navigator.mediaDevices.getUserMedia({ video: true, audio: false })
            .then(stream => {
                localVideoStream = stream;
                videoContainer.innerHTML = "";
                const videoElement = document.createElement("video");
                videoElement.srcObject = stream;
                videoElement.autoplay = true;
                videoElement.playsInline = true;
                videoElement.muted = true; // mute self-preview
                videoElement.classList.add("w-full", "h-full", "rounded-2xl", "object-cover");
                videoContainer.appendChild(videoElement);
                document.getElementById("videoArea").classList.remove("hidden");
            })
            .catch(err => {
                console.error("Gagal akses kamera:", err);
                alert("Tidak bisa mengakses kamera. Periksa izin atau gunakan HTTPS/localhost.");
            });
    } else {
        localVideoStream.getTracks().forEach(track => track.stop());
        localVideoStream = null;
        videoContainer.innerHTML = `<div class="text-center">
            <div class="text-6xl mb-2">📹</div>
            <p class="text-gray-600">Kamera Anda</p>
            <p class="text-xs text-gray-500">(Demo Mode)</p>
        </div>`;
    }
}

function toggleMic() {
    if (!localAudioStream) {
        navigator.mediaDevices.getUserMedia({ video: false, audio: true })
            .then(stream => {
                localAudioStream = stream;
                // create a hidden audio element to keep mic stream active (optional)
                let a = document.getElementById('localMicAudio');
                if(!a){ a = document.createElement('audio'); a.id='localMicAudio'; a.style.display='none'; a.srcObject = stream; a.autoplay=true; document.body.appendChild(a); }
                alert("Mikrofon diaktifkan.");
            })
            .catch(err => {
                console.error("Gagal akses mikrofon:", err);
                alert("Tidak bisa mengakses mikrofon. Periksa izin atau gunakan HTTPS/localhost.");
            });
    } else {
        localAudioStream.getTracks().forEach(t => t.stop());
        localAudioStream = null;
        const a = document.getElementById('localMicAudio'); if(a) a.remove();
        alert("Mikrofon dimatikan.");
    }
}

// --- Share Screen ---
let screenStream = null;
function shareScreen() {
    const videoContainer = document.querySelector("#videoArea .grid > div:first-child");
    if (!screenStream) {
        if (!navigator.mediaDevices || !navigator.mediaDevices.getDisplayMedia) {
            alert("Browser Anda tidak mendukung share screen (getDisplayMedia). Gunakan Chrome/Edge/Firefox terbaru.");
            return;
        }
        navigator.mediaDevices.getDisplayMedia({ video: true, audio: false })
            .then(stream => {
                screenStream = stream;
                videoContainer.innerHTML = "";
                const screenVideo = document.createElement("video");
                screenVideo.srcObject = stream;
                screenVideo.autoplay = true;
                screenVideo.playsInline = true;
                screenVideo.classList.add("w-full", "h-full", "rounded-2xl", "object-cover");
                videoContainer.appendChild(screenVideo);
                document.getElementById("videoArea").classList.remove("hidden");

                // When user stops sharing from browser UI
                stream.getVideoTracks()[0].addEventListener('ended', () => {
                    stopShareScreenUI();
                });
            })
            .catch(err => {
                console.error("Gagal share screen:", err);
                alert("Gagal membagikan layar. Mungkin izin diblokir atau tidak ada sumber untuk dibagikan.");
            });
    } else {
        stopShareScreenUI();
    }
}
function stopShareScreenUI(){
    if(screenStream){
        screenStream.getTracks().forEach(t => t.stop());
        screenStream = null;
    }
    const videoContainer = document.querySelector("#videoArea .grid > div:first-child");
    videoContainer.innerHTML = `<div class="text-center">
            <div class="text-6xl mb-2">📹</div>
            <p class="text-gray-600">Kamera Anda</p>
            <p class="text-xs text-gray-500">(Demo Mode)</p>
        </div>`;
}

// --- Upload File (preview in chat) ---
function uploadFile() {
    const fileInput = document.createElement("input");
    fileInput.type = "file";
    fileInput.multiple = false;
    fileInput.onchange = () => {
        const file = fileInput.files[0];
        if (!file) return;
        const chatMessages = document.getElementById("chatMessages");
        const messageBubble = document.createElement("div");
        messageBubble.classList.add("glass-effect", "p-3", "rounded-2xl");

        const nameEl = document.createElement("div");
        nameEl.textContent = "📎 " + file.name;
        nameEl.classList.add("font-medium","mb-2");
        messageBubble.appendChild(nameEl);

        // If image, show preview
        if (file.type.startsWith("image/")) {
            const img = document.createElement("img");
            img.style.maxWidth = "200px";
            img.style.borderRadius = "12px";
            img.alt = file.name;
            const url = URL.createObjectURL(file);
            img.src = url;
            messageBubble.appendChild(img);

            const a = document.createElement("a");
            a.href = url;
            a.download = file.name;
            a.textContent = "Download gambar";
            a.classList.add("block","mt-2","text-sm","text-blue-600");
            messageBubble.appendChild(a);
        } else {
            // non-image: provide download link
            const a = document.createElement("a");
            const url = URL.createObjectURL(file);
            a.href = url;
            a.download = file.name;
            a.textContent = "Download " + file.name;
            a.classList.add("text-blue-600");
            messageBubble.appendChild(a);
        }

        chatMessages.appendChild(messageBubble);
        chatMessages.scrollTop = chatMessages.scrollHeight;
    };
    fileInput.click();
}

// --- Invite Friends (mailto) ---
function inviteFriendsToRoom() {
    const roomLink = prompt("Masukkan link room (atau biarkan kosong untuk link contoh):", "https://chitchat.example/room/123");
    const subject = encodeURIComponent("Undangan bergabung di ChitChat");
    const bodyText = "Halo! Ayo bergabung di room ChitChat: " + (roomLink || "https://chitchat.example/room/123");
    const body = encodeURIComponent(bodyText);
    window.location.href = `mailto:?subject=${subject}&body=${body}`;
}

// --- Music Player ---
function openMusicPlayer() {
    const modal = document.createElement('div');
    modal.id = 'musicModal';
    modal.style.position = 'fixed';
    modal.style.top = 0; modal.style.left = 0; modal.style.width='100%'; modal.style.height='100%';
    modal.style.background = 'rgba(0,0,0,0.6)'; modal.style.display='flex'; modal.style.justifyContent='center'; modal.style.alignItems='center'; modal.style.zIndex='9999';

    const box = document.createElement('div');
    box.style.background='#fff'; box.style.borderRadius='16px'; box.style.padding='16px'; box.style.width='90%'; box.style.maxWidth='520px';
    box.innerHTML = `
        <h2 style="margin-bottom:8px;">🎵 Pemutar Musik</h2>
        <p style="margin-bottom:8px;">Pilih file audio dari perangkat Anda:</p>
        <input id="musicFile" type="file" accept="audio/*"><br><br>
        <audio id="audioPlayer" controls style="width:100%;"></audio><br><br>
        <div style="display:flex;gap:8px;justify-content:flex-end;"><button id="closeMusicBtn" style="padding:8px 12px;border-radius:8px;background:#ef4444;color:#fff;border:none;cursor:pointer;">Tutup</button></div>
    `;
    modal.appendChild(box);
    document.body.appendChild(modal);

    document.getElementById('musicFile').addEventListener('change', function(e){
        const file = e.target.files[0];
        if(file){ document.getElementById('audioPlayer').src = URL.createObjectURL(file); }
    });
    document.getElementById('closeMusicBtn').addEventListener('click', ()=> modal.remove());
}

// --- Theme toggle (immediate apply) ---
function toggleEasterEgg() {
    const themes = ["pastel-blue","pastel-pink","pastel-purple","sunset-theme","ocean-theme","forest-theme"];
    const body = document.body;
    let idx = themes.findIndex(t => body.classList.contains(t));
    body.classList.remove(...themes);
    idx = (idx + 1) % themes.length;
    body.classList.add(themes[idx]);
}

// --- Voice message (MediaRecorder) ---
let mediaRecorder;
let audioChunks = [];
function sendVoiceMessage() {
    if(!mediaRecorder || mediaRecorder.state === "inactive") {
        navigator.mediaDevices.getUserMedia({ audio: true })
            .then(stream => {
                mediaRecorder = new MediaRecorder(stream);
                audioChunks = [];
                mediaRecorder.addEventListener('dataavailable', e => audioChunks.push(e.data));
                mediaRecorder.addEventListener('stop', () => {
                    const blob = new Blob(audioChunks, { type: 'audio/webm' });
                    const url = URL.createObjectURL(blob);
                    const audio = document.createElement('audio');
                    audio.controls = true; audio.src = url;
                    const chatMessages = document.getElementById('chatMessages');
                    const bubble = document.createElement('div');
                    bubble.classList.add('glass-effect','p-3','rounded-2xl');
                    bubble.appendChild(audio);
                    chatMessages.appendChild(bubble);
                    chatMessages.scrollTop = chatMessages.scrollHeight;
                });
                mediaRecorder.start();
                alert('Merekam... klik tombol 🎤 lagi untuk berhenti.');
            })
            .catch(err => { console.error(err); alert('Gagal akses mikrofon untuk rekaman.'); });
    } else if (mediaRecorder.state === 'recording') {
        mediaRecorder.stop();
    }
}

// --- Whiteboard ---
function openWhiteboard() {
    // modal
    const modal = document.createElement('div');
    modal.id='whiteboardModal';
    modal.style.position='fixed'; modal.style.left=0; modal.style.top=0; modal.style.width='100%'; modal.style.height='100%';
    modal.style.background='rgba(0,0,0,0.6)'; modal.style.display='flex'; modal.style.justifyContent='center'; modal.style.alignItems='center'; modal.style.zIndex='9999';

    const box = document.createElement('div');
    box.style.background='#fff'; box.style.borderRadius='12px'; box.style.padding='12px'; box.style.width='95%'; box.style.maxWidth='900px'; box.style.maxHeight='90%'; box.style.display='flex'; box.style.flexDirection='column';

    box.innerHTML = `
        <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:8px;">
            <h3 style="margin:0;">✏️ Whiteboard</h3>
            <div style="display:flex;gap:8px;align-items:center;">
                <input id="wbColor" type="color" value="#000000" title="Pilih warna">
                <select id="wbBrush" title="Ukuran brush"><option value="2">2</option><option value="4" selected>4</option><option value="8">8</option><option value="12">12</option></select>
                <button id="wbClear" style="padding:6px 10px;border-radius:8px;">Clear</button>
                <button id="wbSave" style="padding:6px 10px;border-radius:8px;">Simpan</button>
                <button id="wbClose" style="padding:6px 10px;border-radius:8px;background:#ef4444;color:#fff;border:none;border-radius:8px;">Tutup</button>
            </div>
        </div>
        <div style="flex:1;display:flex;">
            <canvas id="whiteboardCanvas" style="background:#fff;border-radius:8px;width:100%;height:100%;"></canvas>
        </div>
    `;

    modal.appendChild(box);
    document.body.appendChild(modal);

    const canvas = document.getElementById('whiteboardCanvas');
    // set actual pixel size
    function resizeCanvas(){
        const rect = canvas.getBoundingClientRect();
        canvas.width = rect.width * devicePixelRatio;
        canvas.height = rect.height * devicePixelRatio;
        ctx.scale(devicePixelRatio, devicePixelRatio);
    }
    const ctx = canvas.getContext('2d');
    ctx.lineCap = 'round';

    // initial resize
    resizeCanvas();
    window.addEventListener('resize', resizeCanvas);

    let drawing = false;
    function getPos(e){
        if(e.touches) {
            const t = e.touches[0]; return { x: t.clientX - canvas.getBoundingClientRect().left, y: t.clientY - canvas.getBoundingClientRect().top };
        } else {
            return { x: e.clientX - canvas.getBoundingClientRect().left, y: e.clientY - canvas.getBoundingClientRect().top };
        }
    }
    canvas.addEventListener('pointerdown', (e)=>{ drawing=true; const p=getPos(e); ctx.beginPath(); ctx.moveTo(p.x, p.y); });
    canvas.addEventListener('pointermove', (e)=>{ if(!drawing) return; const p=getPos(e); ctx.lineTo(p.x, p.y); ctx.stroke(); });
    window.addEventListener('pointerup', ()=>{ if(drawing) { drawing=false; ctx.closePath(); } });

    // tools
    document.getElementById('wbColor').addEventListener('change', (e)=>{ ctx.strokeStyle = e.target.value; });
    document.getElementById('wbBrush').addEventListener('change', (e)=>{ ctx.lineWidth = parseInt(e.target.value,10); });
    document.getElementById('wbClear').addEventListener('click', ()=>{ ctx.clearRect(0,0,canvas.width,canvas.height); });
    document.getElementById('wbSave').addEventListener('click', ()=>{
        const dataURL = canvas.toDataURL('image/png');
        const a = document.createElement('a'); a.href = dataURL; a.download = 'whiteboard.png'; a.click();
    });
    document.getElementById('wbClose').addEventListener('click', ()=>{ window.removeEventListener('resize', resizeCanvas); modal.remove(); });
}
</script>
<script>
document.addEventListener('DOMContentLoaded', () => {
  const startBtn = document.getElementById('startCallBtn');
  const endBtn = document.getElementById('endCallBtn');
  const videoArea = document.getElementById('videoArea');
  const inviteBtn = document.getElementById('inviteBtn');

  // Start call
  if (startBtn && endBtn && videoArea) {
    startBtn.addEventListener('click', () => {
      videoArea.classList.remove('hidden');
      startBtn.classList.add('hidden');
      endBtn.classList.remove('hidden');
    });

    // End call
    endBtn.addEventListener('click', () => {
      videoArea.classList.add('hidden');
      endBtn.classList.add('hidden');
      startBtn.classList.remove('hidden');
      alert('Panggilan diakhiri.');
    });
  }
</script>
<script>
document.addEventListener('DOMContentLoaded', () => {
  // Elemen utama
  const startBtn = document.getElementById('startCallBtn');
  const endBtn = document.getElementById('endCallBtn');
  const videoArea = document.getElementById('videoArea');
  const inviteBtn = document.getElementById('inviteBtn');

  const roomsList = document.getElementById('roomsList');
  const createRoomBtn = document.getElementById('createRoomBtn');
  const createRoomConfirmBtn = document.getElementById('createRoomConfirmBtn');
  const newRoomNameInput = document.getElementById('newRoomName');

  // -------- FITUR VIDEO CALL --------
  if (startBtn && endBtn && videoArea) {
    startBtn.addEventListener('click', () => {
      videoArea.classList.remove('hidden');
      startBtn.classList.add('hidden');
      endBtn.classList.remove('hidden');
    });

    endBtn.addEventListener('click', () => {
      videoArea.classList.add('hidden');
      endBtn.classList.add('hidden');
      startBtn.classList.remove('hidden');
      alert('Panggilan diakhiri.');
    });
  }

  // -------- FITUR UNDANG TEMAN --------
  if (inviteBtn) {
    inviteBtn.addEventListener('click', () => {
      const link = window.location.href;
      if (navigator.clipboard) {
        navigator.clipboard.writeText(link).then(() => {
          alert('Link room disalin ke clipboard:\n' + link);
        });
      } else {
        prompt('Salin link ini untuk mengundang teman:', link);
      }
    });
  }

  // -------- FITUR BUAT ROOM --------
  if (createRoomBtn) {
    createRoomBtn.addEventListener('click', () => {
      document.getElementById('createRoomModal').classList.remove('hidden');
    });
  }

  if (createRoomConfirmBtn) {
    createRoomConfirmBtn.addEventListener('click', () => {
      const name = newRoomNameInput.value.trim();
      if (!name) {
        alert('Nama room tidak boleh kosong.');
        return;
      }

      // Buat elemen room baru
      const roomDiv = document.createElement('div');
      roomDiv.className = 'p-3 rounded-xl bg-white/10 flex justify-between items-center cursor-pointer';
      roomDiv.dataset.room = name;

      const roomNameSpan = document.createElement('span');
      roomNameSpan.textContent = name;
      roomNameSpan.addEventListener('click', () => {
        document.getElementById('roomTitle').textContent = name;
        alert('Berpindah ke room: ' + name);
      });

      const deleteBtn = document.createElement('button');
      deleteBtn.textContent = '❌';
      deleteBtn.className = 'ml-2 text-red-500 hover:text-red-700';
      deleteBtn.addEventListener('click', (e) => {
        e.stopPropagation();
        if (confirm('Hapus room "' + name + '"?')) {
          roomDiv.remove();
        }
      });

      roomDiv.appendChild(roomNameSpan);
      roomDiv.appendChild(deleteBtn);
      roomsList.appendChild(roomDiv);

      // Reset & tutup modal
      newRoomNameInput.value = '';
      document.getElementById('createRoomModal').classList.add('hidden');

      alert('Room "' + name + '" berhasil dibuat.');
    });
  }
});
</script>


</body>
</html>
